

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Customizing CKAN’s JavaScript &mdash; CKAN 2.7.0a documentation</title>
  

  
  

  

  
  
    

  

  
  

  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  

  
    <link rel="top" title="CKAN 2.7.0a documentation" href="../index.html"/>
        <link rel="up" title="Theming guide" href="index.html"/>
        <link rel="next" title="Best practices for writing CKAN themes" href="best-practices.html"/>
        <link rel="prev" title="Adding CSS and JavaScript files using Fanstatic" href="fanstatic.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.ckan.org/en/latest/theming/javascript.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'theming/javascript'
</script>

<script type="text/javascript" src="../_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../contents.html" class="icon icon-home"> CKAN
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="http://docs.ckan.org//en/latest/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user-guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysadmin-guide.html">Sysadmin guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintaining/index.html">Maintainer&#8217;s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions/index.html">Extending guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Theming guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="templates.html">Customizing CKAN&#8217;s templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="static-files.html">Adding static files</a></li>
<li class="toctree-l2"><a class="reference internal" href="css.html">Customizing CKAN&#8217;s CSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="fanstatic.html">Adding CSS and JavaScript files using Fanstatic</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="javascript.html">Customizing CKAN&#8217;s JavaScript</a><ul>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#initializing-a-javascript-module">Initializing a JavaScript module</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#this-options-and-this-el"><tt class="docutils literal"><span class="pre">this.options</span></tt> and <tt class="docutils literal"><span class="pre">this.el</span></tt></a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#default-values-for-options">Default values for options</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#ajax-event-handling-and-ckan-s-javascript-sandbox">Ajax, event handling and CKAN&#8217;s JavaScript sandbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#error-handling">Error handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#pubsub">Pubsub</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#jquery-plugins">jQuery plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#internationalization">Internationalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="javascript.html#testing-javascript-modules">Testing JavaScript modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="best-practices.html">Best practices for writing CKAN themes</a></li>
<li class="toctree-l2"><a class="reference internal" href="jinja-tags.html">Custom Jinja2 tags reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="variables-and-functions.html">Variables and functions available to templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript-module-objects-and-methods.html">Objects and methods available to JavaScript modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="template-helper-functions.html">Template helper functions reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="template-snippets.html">Template snippets reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript-sandbox.html">JavaScript sandbox reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="javascript-api-client.html">JavaScript API client reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="jquery-plugins.html">CKAN jQuery plugins reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../contents.html">CKAN</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../contents.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Theming guide</a> &raquo;</li>
      
    <li>Customizing CKAN&#8217;s JavaScript</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/ckan/ckan/blob/master/doc/theming/javascript.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="customizing-ckan-s-javascript">
<span id="javascript-modules"></span><h1>Customizing CKAN&#8217;s JavaScript<a class="headerlink" href="javascript.html#customizing-ckan-s-javascript" title="Permalink to this headline">¶</a></h1>
<p>JavaScript code in CKAN is broken down into <em>modules</em>: small, independent units
of JavaScript code. CKAN themes can add JavaScript features by providing their
own modules. This tutorial will explain the main concepts involved in CKAN
JavaScript modules and walk you through the process of adding custom modules
to themes.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>This tutorial assumes a basic understanding of CKAN plugins and templating,
see:</p>
<ul class="last simple">
<li><a class="reference internal" href="../extensions/index.html"><em>Extending guide</em></a></li>
<li><a class="reference internal" href="templates.html"><em>Customizing CKAN&#8217;s templates</em></a></li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>This tutorial assumes a basic understanding of JavaScript and jQuery,
see:</p>
<ul class="last simple">
<li><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">JavaScript on the Mozilla Developer Network</a></li>
<li><a class="reference external" href="http://jquery.com/">jQuery.com</a>, including the
<a class="reference external" href="http://learn.jquery.com/">jQuery Learning Center</a></li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="../contributing/string-i18n.html"><em>String internationalization</em></a></dt>
<dd>How to mark strings for translation in your JavaScript code.</dd>
</dl>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="javascript.html#overview" title="Permalink to this headline">¶</a></h2>
<p>The idea behind CKAN&#8217;s JavaScript modules is to keep the code simple and
easy to test, debug and maintain, by breaking it down into small,
independent modules. JavaScript modules in CKAN don&#8217;t share global
variables, and don&#8217;t call each other&#8217;s code.</p>
<p>These JavaScript modules are attached to HTML elements in the page, and enhance
the functionality of those elements. The idea is that an HTML element with a
JavaScript module attached should still be fully functional even if JavaScript
is completely disabled (e.g. because the user&#8217;s web browser doesn&#8217;t support
JavaScript). The user experience may not be quite as nice without JavaScript,
but the functionality should still be there. This is a programming technique
known as <em>graceful degradation</em>, and is a basic tenet of web accessibility.</p>
<p>In the sections below, we&#8217;ll walk you through the steps to add a new JavaScript
feature to CKAN - dataset info popovers. We&#8217;ll add an info button to each
dataset on the datasets page which, when clicked, opens a popover containing
some extra information and user actions related to the dataset:</p>
<img alt="A dataset info popover" src="../_images/example_theme_javascript_popover.png" />
</div>
<div class="section" id="initializing-a-javascript-module">
<h2>Initializing a JavaScript module<a class="headerlink" href="javascript.html#initializing-a-javascript-module" title="Permalink to this headline">¶</a></h2>
<p>To get CKAN to call some custom JavaScript code, we need to:</p>
<ol class="arabic">
<li><p class="first">Implement a JavaScript module, and register it with CKAN.
Create the file <tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/fanstatic/example_theme_popover.js</span></tt>, with these
contents:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// Enable JavaScript&#39;s strict mode. Strict mode catches some common</span>
<span class="c1">// programming errors and throws exceptions, prevents some unsafe actions from</span>
<span class="c1">// being taken, and disables some confusing and bad JavaScript features.</span>
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="nx">ckan</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;example_theme_popover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;ve been initialized for element: &quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This bit of JavaScript calls the <tt class="docutils literal"><span class="pre">ckan.module()</span></tt> function to register a
new JavaScript module with CKAN. <tt class="docutils literal"><span class="pre">ckan.module()</span></tt> takes two arguments: the
name of the module being registered (<tt class="docutils literal"><span class="pre">'example_theme_popover'</span></tt> in this
example) and a function that returns the module itself. The function takes
two arguments, which we&#8217;ll look at later. The module is just a JavaScript
object with a single attribute, <tt class="docutils literal"><span class="pre">initialize</span></tt>, whose value is a function
that CKAN will call to initialize the module. In this example, the
initialize function just prints out a confirmation message - this
JavaScript module doesn&#8217;t do anything interesting yet.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">JavaScript module names should begin with the name of the extension,
to avoid conflicting with other modules. See <a class="reference internal" href="../extensions/best-practices.html#avoid-name-clashes"><em>Avoid name clashes</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each JavaScript module&#8217;s <tt class="docutils literal"><span class="pre">initialize()</span></tt> function is called on
<a class="reference external" href="http://api.jquery.com/ready/">DOM ready</a>.</p>
</div>
</li>
<li><p class="first">Include the JavaScript module in a page, using Fanstatic, and apply it to
one or more HTML elements on that page. We&#8217;ll override CKAN&#8217;s
<tt class="docutils literal"><span class="pre">package_item.html</span></tt> template snippet to insert our module whenever a
package is rendered as part of a list of packages (for example, on the
dataset search page). Create the file
<tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/templates/snippets/package_item.html</span></tt> with these
contents:</p>
<div class="highlight-django"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span><span class="x"></span>

<span class="x">  </span><span class="c">{# Use Fanstatic to include our custom JavaScript module.</span>
<span class="c">     A &lt;script&gt; tag for the module will be inserted in the right place at the</span>
<span class="c">     bottom of the page. #}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">resource</span> <span class="s1">&#39;example_theme/example_theme_popover.js&#39;</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">  </span><span class="c">{# Apply our JavaScript module to an HTML element. The data-module attribute,</span>
<span class="c">     which can be applied to any HTML element, tells CKAN to initialize an</span>
<span class="c">     instance of the named JavaScript module for the element.</span>
<span class="c">     The initialize() method of our module will be called with this HTML</span>
<span class="c">     element as its this.el object. #}</span><span class="x"></span>
<span class="x">  &lt;button data-module=&quot;example_theme_popover&quot;</span>
<span class="x">          class=&quot;btn&quot;</span>
<span class="x">          href=&quot;#&quot;&gt;</span>
<span class="x">    &lt;i class=&quot;icon-info-sign&quot;&gt;&lt;/i&gt;</span>
<span class="x">  &lt;/button&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Using_data_attributes">Using data-* attributes</a>
on the Mozilla Developer Network.</p>
</div>
<p>If you now restart the development server and open
<a class="reference external" href="http://127.0.0.1:5000/dataset">http://127.0.0.1:5000/dataset</a> in your web browser, you should see an
extra info button next to each dataset shown. If you open a
JavaScript console in your browser, you should see the message that your
module has printed out.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p>Most web browsers come with built-in developer tools including a
JavaScript console that lets you see text printed by JavaScript code
to <tt class="docutils literal"><span class="pre">console.log()</span></tt>, a JavaScript debugger, and more. For example:</p>
<ul class="last simple">
<li><a class="reference external" href="https://developer.mozilla.org/en-US/docs/Tools">Firefox Developer Tools</a></li>
<li><a class="reference external" href="https://www.getfirebug.com/">Firebug</a></li>
<li><a class="reference external" href="https://developers.google.com/chrome-developer-tools/">Chrome DevTools</a></li>
</ul>
</div>
<p>If you have more than one dataset on your page, you&#8217;ll see the module&#8217;s
message printed once for each dataset. The <tt class="docutils literal"><span class="pre">package_item.html</span></tt> template
snippet is rendered once for each dataset that&#8217;s shown in the list, so your
<tt class="docutils literal"><span class="pre">&lt;button&gt;</span></tt> element with the <tt class="docutils literal"><span class="pre">data-module=&quot;example_theme_popover&quot;</span></tt>
attribute is rendered once for each dataset, and CKAN creates a new instance
of your JavaScript module for each of these <tt class="docutils literal"><span class="pre">&lt;button&gt;</span></tt> elements.  If you
view the source of your page, however, you&#8217;ll see that
<tt class="docutils literal"><span class="pre">example_theme_popover.js</span></tt> is only included with a <tt class="docutils literal"><span class="pre">&lt;script&gt;</span></tt> tag once.
Fanstatic is smart enough to deduplicate resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">JavaScript modules <em>must</em> be included as Fanstatic resources,
you can&#8217;t add them to a <tt class="docutils literal"><span class="pre">public</span></tt> directory and include them using your
own <tt class="docutils literal"><span class="pre">&lt;script&gt;</span></tt> tags.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="this-options-and-this-el">
<span id="options-and-el"></span><h2><tt class="docutils literal"><span class="pre">this.options</span></tt> and <tt class="docutils literal"><span class="pre">this.el</span></tt><a class="headerlink" href="javascript.html#this-options-and-this-el" title="Permalink to this headline">¶</a></h2>
<p>Now let&#8217;s start to make our JavaScript module do something useful: show a
<a class="reference external" href="http://getbootstrap.com/2.3.2/javascript.html#popovers">Bootstrap popover</a>
with some extra info about the dataset when the user clicks on the info button.</p>
<p>First, we need our Jinja template to pass some of the dataset&#8217;s fields to our
JavaScript module as <em>options</em>. Change <tt class="docutils literal"><span class="pre">package_item.html</span></tt> to look like
this:</p>
<div class="highlight-django"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">resource</span> <span class="s1">&#39;example_theme/example_theme_popover.js&#39;</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">  </span><span class="c">{# Apply our JavaScript module to an HTML &lt;button&gt; element.</span>
<span class="c">     The additional data-module-* attributes are options that will be passed</span>
<span class="c">     to the JavaScript module. #}</span><span class="x"></span>
<span class="x">  &lt;button data-module=&quot;example_theme_popover&quot;</span>
<span class="x">          data-module-title=&quot;</span><span class="cp">{{</span> <span class="nv">package.title</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-license=&quot;</span><span class="cp">{{</span> <span class="nv">package.license_title</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-num_resources=&quot;</span><span class="cp">{{</span> <span class="nv">package.num_resources</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>
<span class="x">    &lt;i class=&quot;icon-info-sign&quot;&gt;&lt;/i&gt;</span>
<span class="x">  &lt;/button&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>This adds some <tt class="docutils literal"><span class="pre">data-module-*</span></tt> attributes to our <tt class="docutils literal"><span class="pre">&lt;button&gt;</span></tt> element, e.g.
<tt class="docutils literal"><span class="pre">data-module-title=&quot;{{</span> <span class="pre">package.title</span> <span class="pre">}}&quot;</span></tt> (<tt class="docutils literal"><span class="pre">{{</span> <span class="pre">package.title</span> <span class="pre">}}</span></tt> is a
<a class="reference internal" href="templates.html#expressions-and-variables"><em>Jinja2 expression</em></a> that evaluates to the
title of the dataset, CKAN passes the Jinja2 variable <tt class="docutils literal"><span class="pre">package</span></tt> to our
template).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Although HTML 5 treats any attribute named <tt class="docutils literal"><span class="pre">data-*</span></tt> as a data attribute,
only attributes named <tt class="docutils literal"><span class="pre">data-module-*</span></tt> will be passed as options to a CKAN
JavaScript module. So we have to named our parameters
<tt class="docutils literal"><span class="pre">data-module-title</span></tt> etc., not just <tt class="docutils literal"><span class="pre">data-title</span></tt>.</p>
</div>
<p>Now let&#8217;s make use of these options in our JavaScript module. Change
<tt class="docutils literal"><span class="pre">example_theme_popover.js</span></tt> to look like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="cm">/* example_theme_popover</span>
<span class="cm"> *</span>
<span class="cm"> * This JavaScript module adds a Bootstrap popover with some extra info about a</span>
<span class="cm"> * dataset to the HTML element that the module is applied to. Users can click</span>
<span class="cm"> * on the HTML element to show the popover.</span>
<span class="cm"> *</span>
<span class="cm"> * title - the title of the dataset</span>
<span class="cm"> * license - the title of the dataset&#39;s copyright license</span>
<span class="cm"> * num_resources - the number of resources that the dataset has.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="nx">ckan</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;example_theme_popover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

      <span class="c1">// Access some options passed to this JavaScript module by the calling</span>
      <span class="c1">// template.</span>
      <span class="kd">var</span> <span class="nx">num_resources</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">num_resources</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">license</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">license</span><span class="p">;</span>

      <span class="c1">// Format a simple string with the number of resources and the license,</span>
      <span class="c1">// e.g. &quot;3 resources, Open Data Commons Attribution License&quot;.</span>
      <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="s1">&#39;NUM resources, LICENSE&#39;</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;NUM&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">num_resources</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;LICENSE&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">license</span><span class="p">)</span>

      <span class="c1">// Add a Bootstrap popover to the HTML element (this.el) that this</span>
      <span class="c1">// JavaScript module was initialized on.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
                       <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
                       <span class="nx">placement</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It&#8217;s best practice to add a docstring to the top of a JavaScript module,
as in the example above, briefly documenting what the module does and what
options it takes. See <a class="reference internal" href="best-practices.html#javascript-module-docstrings-best-practice"><em>JavaScript modules should have docstrings</em></a>.</p>
</div>
<p>Any <tt class="docutils literal"><span class="pre">data-module-*</span></tt> attributes on the HTML element are passed into the
JavaScript module in the object <tt class="docutils literal"><span class="pre">this.options</span></tt>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>      <span class="kd">var</span> <span class="nx">num_resources</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">num_resources</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">license</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">license</span><span class="p">;</span>
</pre></div>
</div>
<p>A JavaScript module can access the HTML element that it was applied to
through the <tt class="docutils literal"><span class="pre">this.el</span></tt> variable. To add a popover to our info button, we call
Bootstap&#8217;s <tt class="docutils literal"><span class="pre">popover()</span></tt> function on the element, passing in an options object
with some of the options that Bootstrap&#8217;s popovers accept:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>// Add a Bootstrap popover to the HTML element (this.el) that this
// JavaScript module was initialized on.
this.el.popover({title: this.options.title,
                 content: content,
                 placement: &#39;left&#39;});
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">For other objects and functions available to JavaScript modules, see
<a class="reference internal" href="javascript-module-objects-and-methods.html"><em>Objects and methods available to JavaScript modules</em></a>.</p>
</div>
</div>
<div class="section" id="default-values-for-options">
<h2>Default values for options<a class="headerlink" href="javascript.html#default-values-for-options" title="Permalink to this headline">¶</a></h2>
<p>Default values for JavaScript module options can be provided by adding an
<tt class="docutils literal"><span class="pre">options</span></tt> object to the module. If the HTML element doesn&#8217;t have a
<tt class="docutils literal"><span class="pre">data-module-*</span></tt> attribute for an option, then the default will be used
instead. For example...</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Think of an example to do using default values.</p>
</div>
</div>
<div class="section" id="ajax-event-handling-and-ckan-s-javascript-sandbox">
<span id="ajax"></span><h2>Ajax, event handling and CKAN&#8217;s JavaScript sandbox<a class="headerlink" href="javascript.html#ajax-event-handling-and-ckan-s-javascript-sandbox" title="Permalink to this headline">¶</a></h2>
<p>So far, we&#8217;ve used simple JavaScript string formatting to put together the
contents of our popover. If we want the popover to contain much more complex
HTML we really need to render a template for it, using the full power of
<a class="reference internal" href="templates.html"><em>Jinja2 templates</em></a> and CKAN&#8217;s
<a class="reference internal" href="templates.html#template-helper-functions"><em>template helper functions</em></a>. Let&#8217;s edit our
plugin to use a Jinja2 template to render the contents of the popups nicely.</p>
<p>First, edit <tt class="docutils literal"><span class="pre">package_item.html</span></tt> to make it pass a few more parameters to the
JavaScript module using <tt class="docutils literal"><span class="pre">data-module-*</span></tt> attributes:</p>
<div class="highlight-django"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span><span class="x"></span>

<span class="x">  </span><span class="cp">{%</span> <span class="k">resource</span> <span class="s1">&#39;example_theme/example_theme_popover.js&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">resource</span> <span class="s1">&#39;example_theme/example_theme_popover.css&#39;</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">  &lt;button data-module=&quot;example_theme_popover&quot;</span>
<span class="x">          data-module-id=&quot;</span><span class="cp">{{</span> <span class="nv">package.id</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-title=&quot;</span><span class="cp">{{</span> <span class="nv">package.title</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-license_title=&quot;</span><span class="cp">{{</span> <span class="nv">package.license_title</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-num_resources=&quot;</span><span class="cp">{{</span> <span class="nv">package.num_resources</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>
<span class="x">    &lt;i class=&quot;icon-info-sign&quot;&gt;&lt;/i&gt;</span>
<span class="x">  &lt;/button&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>We&#8217;ve also added a second <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">resource</span> <span class="pre">%}</span></tt> tag to the snippet above, to
include a custom CSS file. We&#8217;ll see the contents of that CSS file later.</p>
<p>Next, we need to add a new template snippet to our extension that will be used
to render the contents of the popovers. Create this
<tt class="docutils literal"><span class="pre">example_theme_popover.html</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ckanext-example_theme/
  ckanext/
    example_theme/
      templates/
        ajax_snippets/
          example_theme_popover.html
</pre></div>
</div>
<p>and put these contents in it:</p>
<div class="highlight-django"><div class="highlight"><pre><span></span><span class="c">{# The contents for a dataset popover.</span>

<span class="c">   id - the id of the dataset</span>
<span class="c">   num_resources - the dataset&#39;s number of resources</span>
<span class="c">   license_title - the dataset&#39;s license title</span>

<span class="c">#}</span><span class="x"></span>
<span class="x">&lt;div class=&quot;context-info&quot;&gt;</span>
<span class="x">  &lt;div class=&quot;nums&quot;&gt;</span>
<span class="x">    &lt;dl&gt;</span>

<span class="x">      &lt;dt&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Followers&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&lt;/dt&gt;</span>
<span class="x">      &lt;dd&gt;</span><span class="cp">{{</span> <span class="nv">h.follow_count</span><span class="o">(</span><span class="s1">&#39;dataset&#39;</span><span class="o">,</span> <span class="nv">id</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&lt;/dd&gt;</span>

<span class="x">      &lt;dt&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Resources&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&lt;/dt&gt;</span>
<span class="x">      &lt;dd&gt;</span><span class="cp">{{</span> <span class="nv">num_resources</span> <span class="cp">}}</span><span class="x">&lt;/dd&gt;</span>

<span class="x">    &lt;/dl&gt;</span>
<span class="x">  &lt;/div&gt;</span>

<span class="x">  &lt;div class=&quot;license&quot;&gt;</span>
<span class="x">    &lt;dl&gt;</span>
<span class="x">      &lt;dt&gt;License&lt;/dt&gt;</span>
<span class="x">      &lt;dd&gt;</span><span class="cp">{{</span> <span class="nv">license_title</span> <span class="cp">}}</span><span class="x">&lt;/dd&gt;</span>
<span class="x">    &lt;/dl&gt;</span>
<span class="x">  &lt;/div&gt;</span>

<span class="x">  &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;</span>

<span class="x">  </span><span class="cp">{{</span> <span class="nv">h.follow_button</span><span class="o">(</span><span class="s1">&#39;dataset&#39;</span><span class="o">,</span> <span class="nv">id</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>

<span class="x">  &lt;a class=&quot;btn go-to-dataset&quot;</span>
<span class="x">     href=&quot;</span><span class="cp">{{</span> <span class="nv">h.url_for</span><span class="o">(</span><span class="nv">controller</span><span class="o">=</span><span class="s1">&#39;package&#39;</span><span class="o">,</span> <span class="nv">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="o">,</span> <span class="nv">id</span><span class="o">=</span><span class="nv">id</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>
<span class="x">    &lt;i class=&quot;icon-circle-arrow-right&quot;&gt;&lt;/i&gt;</span>
<span class="x">    Go to dataset</span>
<span class="x">  &lt;/a&gt;</span>

<span class="x">&lt;/div&gt;</span>
</pre></div>
</div>
<p>This is a Jinja2 template that renders some nice looking contents for a
popover, containing a few bits of information about a dataset. It uses a number
of CKAN&#8217;s Jinja2 templating features, including marking user-visible strings
for translation and calling template helper functions. See <a class="reference internal" href="templates.html"><em>Customizing CKAN&#8217;s templates</em></a>
for details about Jinja2 templating in CKAN.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The new template file has to be in a <tt class="docutils literal"><span class="pre">templates/ajax_snippets/</span></tt> directory
so that we can use the template from our JavaScript code using
CKAN&#8217;s <tt class="xref js js-func docutils literal"><span class="pre">getTemplate()</span></tt> function. Only templates
from <tt class="docutils literal"><span class="pre">ajax_snippets</span></tt> directories are available from the
<tt class="xref js js-func docutils literal"><span class="pre">getTemplate()</span></tt> function.</p>
</div>
<p>Next, edit <tt class="docutils literal"><span class="pre">fanstatic/example_theme_popover.js</span></tt> as shown below.
There&#8217;s a lot going on in this new JavaScript code, including:</p>
<ul>
<li><p class="first">Using <a class="reference external" href="http://getbootstrap.com/2.3.2/javascript.html#popovers">Bootstrap&#8217;s popover API</a>
to show and hide popovers, and set their contents.</p>
</li>
<li><p class="first">Using <a class="reference external" href="http://api.jquery.com/category/events/">jQuery&#8217;s event handling API</a>
to get our functions to be called when the user clicks on a button.</p>
</li>
<li><p class="first">Using a function from CKAN&#8217;s <a class="reference internal" href="javascript-sandbox.html"><em>JavaScript sandbox</em></a>.</p>
<p>The sandbox is a JavaScript object, available to all JavaScript modules
as <tt class="docutils literal"><span class="pre">this.sandbox</span></tt>, that contains a collection of useful functions and
variables.</p>
<p><tt class="xref js js-data docutils literal"><span class="pre">this.sandbox.client</span></tt> is a CKAN API client written in JavaScript, that
should be used whenever a JavaScript module needs to talk to the CKAN API,
instead of modules doing their own HTTP requests.</p>
<p><tt class="xref js js-func docutils literal"><span class="pre">this.sandbox.client.getTemplate()</span></tt> is a function that sends an
asynchronous (ajax) HTTP request (i.e. send an HTTP request from
JavaScript and receive the response in JavaScript, without causing
the browser to reload the whole page) to CKAN asking for a template snippet
to be rendered.</p>
</li>
</ul>
<p>Hopefully the liberal commenting in the code below makes it clear enough what&#8217;s
going on:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="nx">ckan</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;example_theme_popover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

      <span class="c1">// proxyAll() ensures that whenever an _on*() function from this</span>
      <span class="c1">// JavaScript module is called, the `this` variable in the function will</span>
      <span class="c1">// be this JavaScript module object.</span>
      <span class="c1">//</span>
      <span class="c1">// You probably want to call proxyAll() like this in the initialize()</span>
      <span class="c1">// function of most modules.</span>
      <span class="c1">//</span>
      <span class="c1">// This is a shortcut function provided by CKAN, it wraps jQuery&#39;s</span>
      <span class="c1">// proxy() function: http://api.jquery.com/jQuery.proxy/</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">proxyAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="sr">/_on/</span><span class="p">);</span>

      <span class="c1">// Add a Bootstrap popover to the button. Since we don&#39;t have the HTML</span>
      <span class="c1">// from the snippet yet, we just set the content to &quot;Loading...&quot;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                       <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Loading...&#39;</span><span class="p">,</span> <span class="nx">placement</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>

      <span class="c1">// Add an event handler to the button, when the user clicks the button</span>
      <span class="c1">// our _onClick() function will be called.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onClick</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">// Whether or not the rendered snippet has already been received from CKAN.</span>
    <span class="nx">_snippetReceived</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

    <span class="nx">_onClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Send an ajax request to CKAN to render the popover.html snippet.</span>
        <span class="c1">// We wrap this in an if statement because we only want to request</span>
        <span class="c1">// the snippet from CKAN once, not every time the button is clicked.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_snippetReceived</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getTemplate</span><span class="p">(</span><span class="s1">&#39;example_theme_popover.html&#39;</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">_onReceiveSnippet</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_snippetReceived</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="c1">// CKAN calls this function when it has rendered the snippet, and passes</span>
    <span class="c1">// it the rendered HTML.</span>
    <span class="nx">_onReceiveSnippet</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// Replace the popover with a new one that has the rendered HTML from the</span>
      <span class="c1">// snippet as its contents.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                       <span class="nx">content</span><span class="o">:</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">placement</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>
    <span class="p">},</span>

  <span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Finally, we need some custom CSS to make the HTML from our new snippet look
nice. In <tt class="docutils literal"><span class="pre">package_item.html</span></tt> above we added a <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">resource</span> <span class="pre">%}</span></tt> tag to
include a custom CSS file. Now we need to create that file,
<tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/fanstatic/example_theme_popover.css</span></tt>:</p>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="nc">.dataset-list</span> <span class="nc">.popover</span> <span class="nc">.nums</span> <span class="p">{</span>

  <span class="c">/* We&#39;re reusing the .nums class from the dataset read page,</span>
<span class="c">   * but we don&#39;t want the border, margin and padding, get rid of them. */</span>
  <span class="nb">border</span><span class="o">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nb">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nb">padding</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>

  <span class="c">/* We want the license and numbers to appear side by side, so float the</span>
<span class="c">   * numbers list to the left and make it take up just over half of</span>
<span class="c">   * the width of the popover. */</span>
  <span class="nb">float</span><span class="o">:</span> <span class="nb">left</span><span class="p">;</span>
  <span class="nb">width</span><span class="o">:</span> <span class="m">55%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.dataset-list</span> <span class="nc">.popover</span> <span class="nc">.license</span> <span class="p">{</span>

  <span class="c">/* Prevent the words in the license from being wrapped mid-word. */</span>
  <span class="n">word</span><span class="o">-</span><span class="n">break</span><span class="o">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">all</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.dataset-list</span> <span class="nc">.popover</span> <span class="nc">.go-to-dataset</span> <span class="p">{</span>

  <span class="c">/* Float the &quot;Go to dataset&quot; button to the right side of the popover,</span>
<span class="c">   * this puts some space between the two buttons. */</span>
  <span class="nb">float</span><span class="o">:</span> <span class="nb">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Restart CKAN, and your dataset popovers should be looking much better.</p>
</div>
<div class="section" id="error-handling">
<h2>Error handling<a class="headerlink" href="javascript.html#error-handling" title="Permalink to this headline">¶</a></h2>
<p>What if our JavaScript makes an Ajax request to CKAN, such as our
<tt class="xref js js-func docutils literal"><span class="pre">getTemplate()</span></tt> call above, and gets an error in
response? We can simulate this by changing the name of the requested template
file to one that doesn&#8217;t exist:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>            <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getTemplate</span><span class="p">(</span><span class="s1">&#39;foobar.html&#39;</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">_onReceiveSnippet</span><span class="p">);</span>
</pre></div>
</div>
<p>If you reload the datasets page after making this change, you&#8217;ll see that when
you click on a popover its contents remain <em>Loading...</em>. If you have a
development console open in your browser, you&#8217;ll see the error response from
CKAN each time you click to open a popover.</p>
<p>Our JavaScript module&#8217;s <tt class="docutils literal"><span class="pre">_onReceiveSnippet()</span></tt> function is only called if the
request gets a successful response from CKAN.
<tt class="xref js js-func docutils literal"><span class="pre">getTemplate()</span></tt> also accepts a second callback
function parameter that will be called when CKAN sends an error response.
Add this parameter to the <tt class="xref js js-func docutils literal"><span class="pre">getTemplate()</span></tt> call:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>            <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getTemplate</span><span class="p">(</span><span class="s1">&#39;foobar.html&#39;</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">_onReceiveSnippet</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">_onReceiveSnippetError</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
</pre></div>
</div>
<p>Now add the new error function to the JavaScript module:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>    <span class="nx">_onReceiveSnippetError</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">error</span><span class="p">.</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">statusText</span> <span class="o">+</span> <span class="s1">&#39; :(&#39;</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                       <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">placement</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_snippetReceived</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>
</pre></div>
</div>
<p>After making these changes, you should see that if CKAN responds with an
error, the contents of the popover are replaced with the error message from
CKAN.</p>
</div>
<div class="section" id="pubsub">
<span id="id1"></span><h2>Pubsub<a class="headerlink" href="javascript.html#pubsub" title="Permalink to this headline">¶</a></h2>
<p>You may have noticed that, with our example code so far, if you click on the
info button of one dataset on the page then click on the info button of another
dataset, both dataset&#8217;s popovers are shown. The first popover doesn&#8217;t disappear
when the second appears, and the popovers may overlap. If you click on all the
info buttons on the page, popovers for all of them will be shown at once:</p>
<img alt="Dataset info popovers overlapping with eachother" src="../_images/example_theme_overlapping_popovers.png" />
<p>To make one popover disappear when another appears, we can use CKAN&#8217;s
<tt class="xref js js-func docutils literal"><span class="pre">publish()</span></tt> and
<tt class="xref js js-func docutils literal"><span class="pre">subscribe()</span></tt> functions. These pair of functions
allow different instances of a JavaScript module (or instances of different
JavaScript modules) on the same page to talk to each other.
The way it works is:</p>
<ol class="arabic">
<li><p class="first">Modules can subscribe to events by calling
<tt class="xref js js-func docutils literal"><span class="pre">this.sandbox.client.subscribe()</span></tt>, passing the &#8216;topic&#8217;
(a string that identifies the type of event to subscribe to) and a callback
function.</p>
</li>
<li><p class="first">Modules can call <tt class="xref js js-func docutils literal"><span class="pre">this.sandbox.client.publish()</span></tt> to
publish an event for all subscribed modules to receive, passing the topic
string and one or more further parameters that will be passed on as
parameters to the receiver functions.</p>
</li>
<li><p class="first">When a module calls <tt class="xref js js-func docutils literal"><span class="pre">publish()</span></tt>, any callback
functions registered by previous calls to
<tt class="xref js js-func docutils literal"><span class="pre">subscribe()</span></tt> with the same topic string will
be called, and passed the parameters that were passed to publish.</p>
</li>
<li><p class="first">If a module no longer wants to receive events for a topic, it calls
<tt class="xref js js-func docutils literal"><span class="pre">unsubscribe()</span></tt>.</p>
<p>All modules that subscribe to events should have a <tt class="docutils literal"><span class="pre">teardown()</span></tt> function
that unsubscribes from the event, to prevent memory leaks. CKAN calls the
<tt class="docutils literal"><span class="pre">teardown()</span></tt> functions of modules when those modules are removed from the
page. See <a class="reference internal" href="best-practices.html#pubsub-unsubscribe-best-practice"><em>JavaScript modules should unsubscribe from events in teardown()</em></a>.</p>
</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Don&#8217;t tightly couple your JavaScript modules by overusing pubsub.
See <a class="reference internal" href="best-practices.html#pubsub-overuse-best-practice"><em>Don&#8217;t overuse pubsub</em></a>.</p>
</div>
<p>Remember that because we attach our <tt class="docutils literal"><span class="pre">example_theme_popover.js</span></tt> module to a
<tt class="docutils literal"><span class="pre">&lt;button&gt;</span></tt> element that is rendered once for each dataset on the page, CKAN
creates one instance of our module for each dataset. The only way these objects
can communicate with each other so that one object can hide its popover when
another object shows its popover, is by using pubsub.</p>
<p>Here&#8217;s a modified version of our <tt class="docutils literal"><span class="pre">example_theme_popover.js</span></tt> file that uses
pubsub to make the dataset popovers disappear whenever a new popover appears:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="nx">ckan</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;example_theme_popover&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">.</span><span class="nx">proxyAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="sr">/_on/</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                       <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Loading...&#39;</span><span class="p">,</span> <span class="nx">placement</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_onClick</span><span class="p">);</span>

      <span class="c1">// Subscribe to &#39;dataset_popover_clicked&#39; events.</span>
      <span class="c1">// Whenever any line of code publishes an event with this topic,</span>
      <span class="c1">// our _onPopoverClicked function will be called.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;dataset_popover_clicked&#39;</span><span class="p">,</span>
                             <span class="k">this</span><span class="p">.</span><span class="nx">_onPopoverClicked</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">teardown</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="s1">&#39;dataset_popover_clicked&#39;</span><span class="p">,</span>
                               <span class="k">this</span><span class="p">.</span><span class="nx">_onPopoverClicked</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">_snippetReceived</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

    <span class="nx">_onClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_snippetReceived</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getTemplate</span><span class="p">(</span><span class="s1">&#39;example_theme_popover.html&#39;</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">_onReceiveSnippet</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_snippetReceived</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Publish a &#39;dataset_popover_clicked&#39; event for other interested</span>
        <span class="c1">// JavaScript modules to receive. Pass the button that was clicked as a</span>
        <span class="c1">// parameter to the receiver functions.</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;dataset_popover_clicked&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="c1">// This callback function is called whenever a &#39;dataset_popover_clicked&#39;</span>
    <span class="c1">// event is published.</span>
    <span class="nx">_onPopoverClicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">button</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// Wrap this in an if, because we don&#39;t want this object to respond to</span>
      <span class="c1">// its own &#39;dataset_popover_clicked&#39; event.</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">button</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Hide this button&#39;s popover.</span>
        <span class="c1">// (If the popover is not currently shown anyway, this does nothing).</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">_onReceiveSnippet</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;destroy&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> <span class="nx">html</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                       <span class="nx">content</span><span class="o">:</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">placement</span><span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">popover</span><span class="p">(</span><span class="s1">&#39;show&#39;</span><span class="p">);</span>
    <span class="p">},</span>

  <span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="jquery-plugins">
<h2>jQuery plugins<a class="headerlink" href="javascript.html#jquery-plugins" title="Permalink to this headline">¶</a></h2>
<p>CKAN provides a number of custom jQuery plugins for JavaScript modules to use
by default, see <a class="reference internal" href="jquery-plugins.html"><em>CKAN jQuery plugins reference</em></a>.
Extensions can also add their own jQuery plugins, and the plugins will then be
available to all JavaScript code via the <tt class="xref js js-data docutils literal"><span class="pre">this.$</span></tt> object.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://learn.jquery.com/plugins/basic-plugin-creation/">How to Create a Basic Plugin</a></dt>
<dd>jQuery&#8217;s own documentation on writing jQuery plugins. Read this for all
the details on writing jQuery plugins, here we&#8217;ll only provide a simple
example and show you how to integrate it with CKAN.</dd>
</dl>
</div>
<p>It&#8217;s a good idea to implement any JavaScript functionality not directly related
to CKAN as a jQuery plugin. That way your CKAN JavaScript modules will be
smaller as they&#8217;ll contain only the CKAN-specific code, and your jQuery plugins
will also be reusable on non-CKAN sites. CKAN core uses jQuery plugins to
implement features including date formatting, warning users about unsaved
changes when leaving a page containing a form without submitting the form,
restricting the set of characters that can be typed into an input field, etc.</p>
<p>Let&#8217;s add a jQuery plugin to our CKAN extension that makes our info buttons
turn green when clicked.</p>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Replace this with a more realistic example.</p>
</div>
<p>First we need to write the jQuery plugin itself. Create the file
<tt class="docutils literal"><span class="pre">ckanext-example_theme/ckanext/example_theme/fanstatic/jquery.greenify.js</span></tt>
with the following contents:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">jQuery</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">greenify</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span> <span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>

<span class="p">})(</span><span class="k">this</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">);</span>
</pre></div>
</div>
<p>If this JavaScript code looks a little confusing at first, it&#8217;s probably
because it&#8217;s using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Immediately-invoked_function_expression">Immediately-Invoked Function Expression (IIFE)</a>
pattern. This is a common JavaScript code pattern in which an anonymous
function is created and then immediately called once, in a single expression.
In the example above, we create an unnamed function that takes a single
parameter, <tt class="docutils literal"><span class="pre">jQuery</span></tt>, and then we call the function passing <tt class="docutils literal"><span class="pre">this.jQuery</span></tt>
to its <tt class="docutils literal"><span class="pre">jQuery</span></tt> parameter. The code inside the body of the function is the
important part. Writing jQuery plugins in this way ensures that
any variables defined inside the plugin are private to the plugin, and don&#8217;t
pollute the global namespace.</p>
<p>In the body of our jQuery plugin, we add a new function called <tt class="docutils literal"><span class="pre">greenify()</span></tt>
to the <tt class="docutils literal"><span class="pre">jQuery</span></tt> object:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">greenify</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span> <span class="p">);</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">jquery.fn</span></tt> is the jQuery prototype object, the object that normal jQuery
objects get all their methods from. By adding a method to this object, we
enable any code that has a jQuery object to call our method on any HTML element
or set of elements. For example, to turn all <tt class="docutils literal"><span class="pre">&lt;a&gt;</span></tt> elements on the page green
you could do: <tt class="docutils literal"><span class="pre">jQuery('a').greenify()</span></tt>.</p>
<p>The code inside the <tt class="docutils literal"><span class="pre">greenify()</span></tt> function just calls jQuery&#8217;s standard
<a class="reference external" href="http://api.jquery.com/css/">css()</a> method to set the CSS <tt class="docutils literal"><span class="pre">color</span></tt>
attribute of the element to <tt class="docutils literal"><span class="pre">green</span></tt>. This is just standard jQuery code,
except that within a custom jQuery function you use <tt class="docutils literal"><span class="pre">this</span></tt> to refer to the
jQuery object, instead of using <tt class="docutils literal"><span class="pre">$</span></tt> or <tt class="docutils literal"><span class="pre">jquery</span></tt> (as you would normally do
when calling jQuery methods from code external to jQuery).</p>
<p>Our method then returns <tt class="docutils literal"><span class="pre">this</span></tt> to allow jQuery method chaining to be used
with our method. For example, a user can set an element&#8217;s CSS <tt class="docutils literal"><span class="pre">color</span></tt>
attribute to <tt class="docutils literal"><span class="pre">green</span></tt> and add the CSS class <tt class="docutils literal"><span class="pre">greenified</span></tt> to the element in
a single expression by chaining our jQuery method with another method:
<tt class="docutils literal"><span class="pre">$('a').greenify().addClass('greenified');</span></tt></p>
<p>Before we can use our <tt class="docutils literal"><span class="pre">greenify()</span></tt> method in CKAN, we need to import the
<tt class="docutils literal"><span class="pre">jquery.greenify.js</span></tt> file into the CKAN page. To do this, add a
<tt class="docutils literal"><span class="pre">{%</span> <span class="pre">resource</span> <span class="pre">%}</span></tt> tag to a template file, just as you would do to include any
other JavaScript or CSS file in CKAN. Edit the <tt class="docutils literal"><span class="pre">package_item.html</span></tt> file:</p>
<div class="highlight-django"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span><span class="x"></span>

<span class="x">  </span><span class="cp">{%</span> <span class="k">resource</span> <span class="s1">&#39;example_theme/example_theme_popover.js&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">resource</span> <span class="s1">&#39;example_theme/example_theme_popover.css&#39;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">resource</span> <span class="s1">&#39;example_theme/jquery.greenify.js&#39;</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">  &lt;button data-module=&quot;example_theme_popover&quot;</span>
<span class="x">          data-module-id=&quot;</span><span class="cp">{{</span> <span class="nv">package.id</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-title=&quot;</span><span class="cp">{{</span> <span class="nv">package.title</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-license_title=&quot;</span><span class="cp">{{</span> <span class="nv">package.license_title</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">          data-module-num_resources=&quot;</span><span class="cp">{{</span> <span class="nv">package.num_resources</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>
<span class="x">    &lt;i class=&quot;icon-info-sign&quot;&gt;&lt;/i&gt;</span>
<span class="x">  &lt;/button&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>Now we can call the <tt class="docutils literal"><span class="pre">greenify()</span></tt> method from our <tt class="docutils literal"><span class="pre">example_theme_popover</span></tt>
JavaScript module. For example, we could add a line to the <tt class="docutils literal"><span class="pre">_onClick()</span></tt>
method in <tt class="docutils literal"><span class="pre">example_theme_popover.js</span></tt> so that when a dataset info button is
clicked it turns green:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>    <span class="nx">_onClick</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Make all the links on the page turn green.</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">).</span><span class="nx">greenify</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_snippetReceived</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">getTemplate</span><span class="p">(</span><span class="s1">&#39;example_theme_popover.html&#39;</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
                                            <span class="k">this</span><span class="p">.</span><span class="nx">_onReceiveSnippet</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_snippetReceived</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">sandbox</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;dataset_popover_clicked&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">},</span>
</pre></div>
</div>
</div>
<div class="section" id="internationalization">
<span id="javascript-i18n"></span><h2>Internationalization<a class="headerlink" href="javascript.html#internationalization" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="../contributing/string-i18n.html#javascript-i18n"><em>Internationalizing strings in JavaScript code</em></a>.</p>
</div>
<div class="section" id="testing-javascript-modules">
<h2>Testing JavaScript modules<a class="headerlink" href="javascript.html#testing-javascript-modules" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">Show how to write tests for the example module.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation"
         aria-label="footer navigation">
      
        <a href="best-practices.html" class="btn btn-neutral float-right"
           title="Best practices for writing CKAN themes"/>
           Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="fanstatic.html" class="btn btn-neutral"
           title="Adding CSS and JavaScript files using Fanstatic">
           <span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr></hr>

  <p>Support the <a href="http://ckan.org">CKAN Association</a>.</p>

  <p class="copyright">
      &copy; 2009-2013, <a href="http://okfn.org/">Open Knowledge Foundation</a>.
    Licensed under <a
    href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
    Attribution ShareAlike (Unported) v3.0 License</a>.<br />
    <img src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" alt="CC License Logo" />
    <a href="http://opendefinition.org/"><img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" border="0"
      alt="{{ _('Open Content') }}" /></a>
  
  </p>

  <p>
    <a href="https://github.com/ckan/ckan">Source</a>
    &mdash;
    <a href="https://github.com/ckan/ckan/issues">Issues</a>
    &mdash;
    <a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">Mailing List</a>
    &mdash;
    <a href="http://twitter.com/CKANProject">Twitter @CKANProject</a>
  </p>

  <p>
    Related Projects:
    <a href="http://thedatahub.org/">The DataHub</a>
    &mdash;
    <a href="http://datacatalogs.org">DataCatalogs.org</a>
    &mdash;
    <a href="http://openspending.org">OpenSpending.org</a>
    &mdash;
    <a href="http://opendatahandbook.org">Open Data Handbook</a>
  </p>


  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a>  provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../../ckan-2.6.0/index.html">ckan-2.6.0</a></dd>
        
          <dd><a href="../../ckan-2.5.3/index.html">ckan-2.5.3</a></dd>
        
          <dd><a href="../../ckan-2.4.4/index.html">ckan-2.4.4</a></dd>
        
          <dd><a href="../../ckan-2.3.5/index.html">ckan-2.3.5</a></dd>
        
          <dd><a href="../../ckan-2.2.3/index.html">ckan-2.2.3</a></dd>
        
          <dd><a href="../../ckan-2.1.5/index.html">ckan-2.1.5</a></dd>
        
          <dd><a href="http://docs.ckan.org/en/ckan-2.0.7/">ckan-2.0.7</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/ckan/downloads/pdf/latest/">pdf</a></dd>
        
          <dd><a href="http://readthedocs.org/projects/ckan/downloads/htmlzip/latest/">htmlzip</a></dd>
        
          <dd><a href="http://readthedocs.org/projects/ckan/downloads/epub/latest/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/ckan/?fromdocs=ckan">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/ckan/?fromdocs=ckan">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.7.0a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>