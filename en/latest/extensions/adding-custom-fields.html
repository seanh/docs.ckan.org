

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Customizing dataset and resource metadata fields using IDatasetForm &mdash; CKAN 2.7.0a documentation</title>
  

  
  

  

  
  
    

  

  
  

  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  

  
    <link rel="top" title="CKAN 2.7.0a documentation" href="../index.html"/>
        <link rel="up" title="Extending guide" href="index.html"/>
        <link rel="next" title="Plugin interfaces reference" href="plugin-interfaces.html"/>
        <link rel="prev" title="Best practices for writing extensions" href="best-practices.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'extensions/adding-custom-fields'
</script>

<script type="text/javascript" src="../_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../contents.html" class="icon icon-home"> CKAN
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="http://docs.ckan.org//en/latest/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user-guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sysadmin-guide.html">Sysadmin guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintaining/index.html">Maintainer&#8217;s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Extending guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.html">Writing extensions tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom-config-settings.html">Using custom config settings in extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="remote-config-update.html">Making configuration options runtime-editable</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing-extensions.html">Testing extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="best-practices.html">Best practices for writing extensions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="adding-custom-fields.html">Customizing dataset and resource metadata fields using IDatasetForm</a><ul>
<li class="toctree-l3"><a class="reference internal" href="adding-custom-fields.html#ckan-schemas-and-validation">CKAN schemas and validation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#adding-custom-fields-to-datasets">Adding custom fields to datasets</a></li>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#updating-the-ckan-schema">Updating the CKAN schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#dataset-types">Dataset types</a></li>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#updating-templates">Updating templates</a></li>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#cleaning-up-the-code">Cleaning up the code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="adding-custom-fields.html#custom-validators">Custom validators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#validator-value"><tt class="docutils literal"><span class="pre">validator(value)</span></tt></a></li>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#validator-value-context"><tt class="docutils literal"><span class="pre">validator(value,</span> <span class="pre">context)</span></tt></a></li>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#validator-key-flattened-data-errors-context"><tt class="docutils literal"><span class="pre">validator(key,</span> <span class="pre">flattened_data,</span> <span class="pre">errors,</span> <span class="pre">context)</span></tt></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="adding-custom-fields.html#tag-vocabularies">Tag vocabularies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#adding-tags-to-the-schema">Adding tags to the schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="adding-custom-fields.html#adding-tags-to-templates">Adding tags to templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="adding-custom-fields.html#adding-custom-fields-to-resources">Adding custom fields to resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding-custom-fields.html#sorting-by-custom-fields-on-the-dataset-search-page">Sorting by custom fields on the dataset search page</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plugin-interfaces.html">Plugin interfaces reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins-toolkit.html">Plugins toolkit reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="validators.html">Validator functions reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="translating-extensions.html">Internationalizing strings in extensions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../theming/index.html">Theming guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../contents.html">CKAN</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../contents.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Extending guide</a> &raquo;</li>
      
    <li>Customizing dataset and resource metadata fields using IDatasetForm</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/ckan/ckan/blob/master/doc/extensions/adding-custom-fields.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="customizing-dataset-and-resource-metadata-fields-using-idatasetform">
<h1>Customizing dataset and resource metadata fields using IDatasetForm<a class="headerlink" href="adding-custom-fields.html#customizing-dataset-and-resource-metadata-fields-using-idatasetform" title="Permalink to this headline">¶</a></h1>
<p>Storing additional metadata for a dataset beyond the default metadata in CKAN
is a common use case. CKAN provides a simple way to do this by allowing you to
store arbitrary key/value pairs against a dataset when creating or updating the
dataset. These appear under the &#8220;Additional Information&#8221; section on the web
interface and in &#8216;extras&#8217; field of the JSON when accessed via the API.</p>
<p>Default extras can only take strings for their keys and values, no
validation is applied to the inputs and you cannot make them mandatory or
restrict the possible values to a defined list. By using CKAN&#8217;s IDatasetForm
plugin interface, a CKAN plugin can add custom, first-class metadata fields to
CKAN datasets, and can do custom validation of these fields.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">In this tutorial we are assuming that you have read the
<a class="reference internal" href="tutorial.html"><em>Writing extensions tutorial</em></a></p>
</div>
<div class="section" id="ckan-schemas-and-validation">
<h2>CKAN schemas and validation<a class="headerlink" href="adding-custom-fields.html#ckan-schemas-and-validation" title="Permalink to this headline">¶</a></h2>
<p>When a dataset is created, updated or viewed, the parameters passed to CKAN
(e.g. via the web form when creating or updating a dataset, or posted to an API
end point) are validated against a schema. For each parameter, the schema will
contain a corresponding list of functions that will be run against the value of
the parameter. Generally these functions are used to validate the value
(and raise an error if the value fails validation) or convert the value to a
different value.</p>
<p>For example, the schemas can allow optional values by using the
<tt class="xref py py-func docutils literal"><span class="pre">ignore_missing()</span></tt> validator or check that a
dataset exists using <a class="reference internal" href="validators.html#ckan.logic.validators.package_id_exists" title="ckan.logic.validators.package_id_exists"><tt class="xref py py-func docutils literal"><span class="pre">package_id_exists()</span></tt></a>. A list
of available validators can be found at the <a class="reference internal" href="validators.html"><em>Validator functions reference</em></a>.
You can also define your own <a class="reference internal" href="adding-custom-fields.html#custom-validators"><em>Custom validators</em></a>.</p>
<p>We will be customizing these schemas to add our additional fields. The
<a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm" title="ckan.plugins.interfaces.IDatasetForm"><tt class="xref py py-class docutils literal"><span class="pre">IDatasetForm</span></tt></a> interface allows us to
override the schemas for creation, updating and displaying of datasets.</p>
<table border="1" class="longtable docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.create_package_schema" title="ckan.plugins.interfaces.IDatasetForm.create_package_schema"><tt class="xref py py-obj docutils literal"><span class="pre">create_package_schema</span></tt></a>()</td>
<td>Return the schema for validating new dataset dicts.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.update_package_schema" title="ckan.plugins.interfaces.IDatasetForm.update_package_schema"><tt class="xref py py-obj docutils literal"><span class="pre">update_package_schema</span></tt></a>()</td>
<td>Return the schema for validating updated dataset dicts.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.show_package_schema" title="ckan.plugins.interfaces.IDatasetForm.show_package_schema"><tt class="xref py py-obj docutils literal"><span class="pre">show_package_schema</span></tt></a>()</td>
<td>Return a schema to validate datasets before they&#8217;re shown to the user.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.is_fallback" title="ckan.plugins.interfaces.IDatasetForm.is_fallback"><tt class="xref py py-obj docutils literal"><span class="pre">is_fallback</span></tt></a>()</td>
<td>Return <tt class="docutils literal"><span class="pre">True</span></tt> if this plugin is the fallback plugin.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.package_types" title="ckan.plugins.interfaces.IDatasetForm.package_types"><tt class="xref py py-obj docutils literal"><span class="pre">package_types</span></tt></a>()</td>
<td>Return an iterable of package types that this plugin handles.</td>
</tr>
</tbody>
</table>
<p>CKAN allows you to have multiple IDatasetForm plugins, each handling different
dataset types. So you could customize the CKAN web front end, for different
types of datasets. In this tutorial we will be defining our plugin as the
fallback plugin. This plugin is used if no other IDatasetForm plugin is found
that handles that dataset type.</p>
<p>The IDatasetForm also has other additional functions that allow you to
provide a custom template to be rendered for the CKAN frontend, but we will
not be using them for this tutorial.</p>
<div class="section" id="adding-custom-fields-to-datasets">
<h3>Adding custom fields to datasets<a class="headerlink" href="adding-custom-fields.html#adding-custom-fields-to-datasets" title="Permalink to this headline">¶</a></h3>
<p>Create a new plugin named <tt class="docutils literal"><span class="pre">ckanext-extrafields</span></tt> and create a class named
<tt class="docutils literal"><span class="pre">ExampleIDatasetFormPlugins</span></tt> inside
<tt class="docutils literal"><span class="pre">ckanext-extrafields/ckanext/extrafields/plugins.py</span></tt> that implements the
<tt class="docutils literal"><span class="pre">IDatasetForm</span></tt> interface and inherits from <tt class="docutils literal"><span class="pre">SingletonPlugin</span></tt> and
<tt class="docutils literal"><span class="pre">DefaultDatasetForm</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># encoding: utf-8</span>

<span class="kn">import</span> <span class="nn">ckan.plugins</span> <span class="kn">as</span> <span class="nn">p</span>
<span class="kn">import</span> <span class="nn">ckan.plugins.toolkit</span> <span class="kn">as</span> <span class="nn">tk</span>


<span class="k">class</span> <span class="nc">ExampleIDatasetFormPlugin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">SingletonPlugin</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">DefaultDatasetForm</span><span class="p">):</span>
    <span class="n">p</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">IDatasetForm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-the-ckan-schema">
<h3>Updating the CKAN schema<a class="headerlink" href="adding-custom-fields.html#updating-the-ckan-schema" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.create_package_schema" title="ckan.plugins.interfaces.IDatasetForm.create_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">create_package_schema()</span></tt></a>
function is used whenever a new dataset is created, we&#8217;ll want update the
default schema and insert our custom field here.  We will fetch the default
schema defined in
<tt class="xref py py-func docutils literal"><span class="pre">default_create_package_schema()</span></tt> by running
<a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.create_package_schema" title="ckan.plugins.interfaces.IDatasetForm.create_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">create_package_schema()</span></tt></a>&#8216;s
super function and update it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">create_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># let&#39;s grab the default schema in our plugin</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExampleIDatasetFormPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create_package_schema</span><span class="p">()</span>
        <span class="c1"># our custom field</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">),</span>
                            <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_to_extras&#39;</span><span class="p">)]</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">schema</span>
</pre></div>
</div>
<p>The CKAN schema is a dictionary where the key is the name of the field and the
value is a list of validators and converters. Here we have a validator to tell
CKAN to not raise a validation error if the value is missing and a converter to
convert the value to and save as an extra. We will want to change the
<a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.update_package_schema" title="ckan.plugins.interfaces.IDatasetForm.update_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">update_package_schema()</span></tt></a> function
with the same update code.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">update_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExampleIDatasetFormPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_package_schema</span><span class="p">()</span>
        <span class="c1"># our custom field</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">),</span>
                            <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_to_extras&#39;</span><span class="p">)]</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">schema</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.show_package_schema" title="ckan.plugins.interfaces.IDatasetForm.show_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">show_package_schema()</span></tt></a> is used
when the <a class="reference internal" href="../api/index.html#ckan.logic.action.get.package_show" title="ckan.logic.action.get.package_show"><tt class="xref py py-func docutils literal"><span class="pre">package_show()</span></tt></a> action is called, we
want the default_show_package_schema to be updated to include our custom field.
This time, instead of converting to an extras field, we want our field to be
converted <em>from</em> an extras field. So we want to use the
<a class="reference internal" href="validators.html#ckan.logic.converters.convert_from_extras" title="ckan.logic.converters.convert_from_extras"><tt class="xref py py-meth docutils literal"><span class="pre">convert_from_extras()</span></tt></a> converter.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">show_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExampleIDatasetFormPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">show_package_schema</span><span class="p">()</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<span class="hll">            <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_from_extras&#39;</span><span class="p">),</span>
</span>                            <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">)]</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">schema</span>
</pre></div>
</div>
</div>
<div class="section" id="dataset-types">
<h3>Dataset types<a class="headerlink" href="adding-custom-fields.html#dataset-types" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.package_types" title="ckan.plugins.interfaces.IDatasetForm.package_types"><tt class="xref py py-meth docutils literal"><span class="pre">package_types()</span></tt></a> function
defines a list of dataset types that this plugin handles. Each dataset has a
field containing its type. Plugins can register to handle specific types of
dataset and ignore others. Since our plugin is not for any specific type of
dataset and we want our plugin to be the default handler, we update the plugin
code to contain the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>        })
        return schema

    def is_fallback(self):
        # Return True to register this plugin as the default handler for
        # package types not handled by any other IDatasetForm plugin.
        return True

    def package_types(self):
        # This plugin doesn&#39;t handle any special package types, it just
        # registers itself as the default (above).
        return []
</pre></div>
</div>
</div>
<div class="section" id="updating-templates">
<h3>Updating templates<a class="headerlink" href="adding-custom-fields.html#updating-templates" title="Permalink to this headline">¶</a></h3>
<p>In order for our new field to be visible on the CKAN front-end, we need to
update the templates. Add an additional line to make the plugin implement the
IConfigurer interface</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleIDatasetFormPlugin</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">SingletonPlugin</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">DefaultDatasetForm</span><span class="p">):</span>
    <span class="n">p</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">IDatasetForm</span><span class="p">)</span>
<span class="hll">    <span class="n">p</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">IConfigurer</span><span class="p">)</span>
</span></pre></div>
</div>
<p>This interface allows to implement a function
<tt class="xref py py-meth docutils literal"><span class="pre">update_config()</span></tt> that allows us
to update the CKAN config, in our case we want to add an additional location
for CKAN to look for templates. Add the following code to your plugin.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="c1"># Add this plugin&#39;s templates dir to CKAN&#39;s extra_template_paths, so</span>
        <span class="c1"># that CKAN will use this plugin&#39;s custom templates.</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">add_template_directory</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You will also need to add a directory under your extension directory to store
the templates. Create a directory called
<tt class="docutils literal"><span class="pre">ckanext-extrafields/ckanext/extrafields/templates/</span></tt> and the subdirectories
<tt class="docutils literal"><span class="pre">ckanext-extrafields/ckanext/extrafields/templates/package/snippets/</span></tt>.</p>
<p>We need to override a few templates in order to get our custom field rendered.
A common option when using a custom schema is to remove the default custom
field handling that allows arbitrary key/value pairs. Create a template
file in our templates directory called
<tt class="docutils literal"><span class="pre">package/snippets/package_metadata_fields.html</span></tt> containing</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="c">{# You could remove &#39;free extras&#39; from the package form like this, but we keep them for this example&#39;s tests.</span>
<span class="c">  {% block custom_fields %}</span>
<span class="c">  {% endblock %}</span>
<span class="c">#}</span><span class="x"></span>
</pre></div>
</div>
<p>This overrides the custom_fields block with an empty block so the default CKAN
custom fields form does not render.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 2.3: </span>Starting from CKAN 2.3 you can combine free extras with custom fields
handled with <tt class="docutils literal"><span class="pre">convert_to_extras</span></tt> and <tt class="docutils literal"><span class="pre">convert_from_extras</span></tt>. On prior
versions you&#8217;ll always need to remove the free extras handling.</p>
</div>
<p>Next add a template in our template
directory called <tt class="docutils literal"><span class="pre">package/snippets/package_basic_fields.html</span></tt> containing</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">package_basic_fields_custom</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{{</span> <span class="nv">form.input</span><span class="o">(</span><span class="s1">&#39;custom_text&#39;</span><span class="o">,</span> <span class="nv">label</span><span class="o">=</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Custom Text&#39;</span><span class="o">),</span> <span class="nv">id</span><span class="o">=</span><span class="s1">&#39;field-custom_text&#39;</span><span class="o">,</span> <span class="nv">placeholder</span><span class="o">=</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;custom text&#39;</span><span class="o">),</span> <span class="nv">value</span><span class="o">=</span><span class="nv">data.custom_text</span><span class="o">,</span> <span class="nv">error</span><span class="o">=</span><span class="nv">errors.custom_text</span><span class="o">,</span> <span class="nv">classes</span><span class="o">=[</span><span class="s1">&#39;control-medium&#39;</span><span class="o">])</span> <span class="cp">}}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>This adds our custom_text field to the editing form. Finally we want to display
our custom_text field on the dataset page. Add another file called
<tt class="docutils literal"><span class="pre">package/snippets/additional_info.html</span></tt> containing</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">extras</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">pkg_dict.custom_text</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">    &lt;tr&gt;</span>
<span class="x">      &lt;th scope=&quot;row&quot; class=&quot;dataset-label&quot;&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Custom Text&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&lt;/th&gt;</span>
<span class="x">      &lt;td class=&quot;dataset-details&quot;&gt;</span><span class="cp">{{</span> <span class="nv">pkg_dict.custom_text</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;/tr&gt;</span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>This template overrides the default extras rendering on the dataset page
and replaces it to just display our custom field.</p>
<p>You&#8217;re done! Make sure you have your plugin installed and setup as in the
<cite>extension/tutorial</cite>. Then run a development server and you should now have
an additional field called &#8220;Custom Text&#8221; when displaying and adding/editing a
dataset.</p>
</div>
<div class="section" id="cleaning-up-the-code">
<h3>Cleaning up the code<a class="headerlink" href="adding-custom-fields.html#cleaning-up-the-code" title="Permalink to this headline">¶</a></h3>
<p>Before we continue further, we can clean up the
<a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.create_package_schema" title="ckan.plugins.interfaces.IDatasetForm.create_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">create_package_schema()</span></tt></a>
and <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.update_package_schema" title="ckan.plugins.interfaces.IDatasetForm.update_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">update_package_schema()</span></tt></a>.
There is a bit of duplication that we could remove. Replace the two functions
with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_modify_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">),</span>
                            <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_to_extras&#39;</span><span class="p">)]</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">schema</span>

    <span class="k">def</span> <span class="nf">create_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExampleIDatasetFormPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create_package_schema</span><span class="p">()</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modify_package_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">schema</span>

    <span class="k">def</span> <span class="nf">update_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExampleIDatasetFormPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_package_schema</span><span class="p">()</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modify_package_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">schema</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-validators">
<span id="id1"></span><h2>Custom validators<a class="headerlink" href="adding-custom-fields.html#custom-validators" title="Permalink to this headline">¶</a></h2>
<p>You may define custom validators in your extensions and
you can share validators between extensions by registering
them with the <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IValidators" title="ckan.plugins.interfaces.IValidators"><tt class="xref py py-class docutils literal"><span class="pre">IValidators</span></tt></a> interface.</p>
<p>Any of the following objects may be used as validators as part
of a custom dataset, group or organization schema. CKAN&#8217;s validation
code will check for and attempt to use them in this order:</p>
<ol class="arabic simple">
<li>a <a class="reference external" href="http://www.formencode.org/en/latest/Validator.html">formencode Validator class</a> (not discussed)</li>
<li>a formencode Validator instance (not discussed)</li>
<li>a callable object taking a single parameter: <tt class="docutils literal"><span class="pre">validator(value)</span></tt></li>
<li>a callable object taking four parameters:
<tt class="docutils literal"><span class="pre">validator(key,</span> <span class="pre">flattened_data,</span> <span class="pre">errors,</span> <span class="pre">context)</span></tt></li>
<li>a callable object taking two parameters
<tt class="docutils literal"><span class="pre">validator(value,</span> <span class="pre">context)</span></tt></li>
</ol>
<div class="section" id="validator-value">
<h3><tt class="docutils literal"><span class="pre">validator(value)</span></tt><a class="headerlink" href="adding-custom-fields.html#validator-value" title="Permalink to this headline">¶</a></h3>
<p>The simplest form of validator is a callable taking a single
parameter. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ckan.plugins.toolkit</span> <span class="kn">import</span> <span class="n">Invalid</span>

<span class="k">def</span> <span class="nf">starts_with_b</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="s2">&quot;Doesn&#39;t start with b&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">starts_with_b</span></tt> validator causes a validation error for values
not starting with &#8216;b&#8217;.
On a web form this validation error would
appear next to the field to which the validator was applied.</p>
<p><tt class="docutils literal"><span class="pre">return</span> <span class="pre">value</span></tt> must be used by validators when accepting data
or the value will be converted to None. This form is useful
for converting data as well, because the return value will
replace the field value passed:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">embiggen</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">embiggen</span></tt> validator will convert values passed to all-uppercase.</p>
</div>
<div class="section" id="validator-value-context">
<h3><tt class="docutils literal"><span class="pre">validator(value,</span> <span class="pre">context)</span></tt><a class="headerlink" href="adding-custom-fields.html#validator-value-context" title="Permalink to this headline">¶</a></h3>
<p>Validators that need access to the database or information
about the user may be written as a callable taking two parameters.
<tt class="docutils literal"><span class="pre">context['session']</span></tt> is the sqlalchemy session object and
<tt class="docutils literal"><span class="pre">context['user']</span></tt> is the username of the logged-in user:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ckan.plugins.toolkit</span> <span class="kn">import</span> <span class="n">Invalid</span>

<span class="k">def</span> <span class="nf">fred_only</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">context</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;fred&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="s1">&#39;only fred may set this value&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
<p>Otherwise this is the same as the single-parameter form above.</p>
</div>
<div class="section" id="validator-key-flattened-data-errors-context">
<h3><tt class="docutils literal"><span class="pre">validator(key,</span> <span class="pre">flattened_data,</span> <span class="pre">errors,</span> <span class="pre">context)</span></tt><a class="headerlink" href="adding-custom-fields.html#validator-key-flattened-data-errors-context" title="Permalink to this headline">¶</a></h3>
<p>Validators that need to access or update multiple fields
may be written as a callable taking four parameters.</p>
<p>All fields and errors in a <tt class="docutils literal"><span class="pre">flattened</span></tt> form are passed to the
validator. The validator must fetch values from <tt class="docutils literal"><span class="pre">flattened_data</span></tt>
and may replace values in <tt class="docutils literal"><span class="pre">flattened_data</span></tt>. The return value
from this function is ignored.</p>
<p><tt class="docutils literal"><span class="pre">key</span></tt> is the flattened key for the field to which this validator was
applied. For example <tt class="docutils literal"><span class="pre">('notes',)</span></tt> for the dataset notes field or
<tt class="docutils literal"><span class="pre">('resources',</span> <span class="pre">0,</span> <span class="pre">'url')</span></tt> for the url of the first resource of the dataset.
These flattened keys are the same in both the <tt class="docutils literal"><span class="pre">flattened_data</span></tt> and <tt class="docutils literal"><span class="pre">errors</span></tt>
dicts passed.</p>
<p><tt class="docutils literal"><span class="pre">errors</span></tt> contains lists of validation errors for each field.</p>
<p><tt class="docutils literal"><span class="pre">context</span></tt> is the same value passed to the two-parameter
form above.</p>
<p>Note that this form can be tricky to use because some of the values in
<tt class="docutils literal"><span class="pre">flattened_data</span></tt> will have had validators applied
but other fields won&#8217;t. You may add this type of validator to the
special schema fields <tt class="docutils literal"><span class="pre">'__before'</span></tt> or <tt class="docutils literal"><span class="pre">'__after'</span></tt> to have them
run before or after all the other validation takes place to avoid
the problem of working with partially-validated data.</p>
</div>
</div>
<div class="section" id="tag-vocabularies">
<h2>Tag vocabularies<a class="headerlink" href="adding-custom-fields.html#tag-vocabularies" title="Permalink to this headline">¶</a></h2>
<p>If you need to add a custom field where the input options are restricted to a
provided list of options, you can use tag vocabularies
<a class="reference internal" href="../maintaining/tag-vocabularies.html"><em>Tag Vocabularies</em></a>.
We will need to create our vocabulary first. By calling
<tt class="xref py py-func docutils literal"><span class="pre">vocabulary_create()</span></tt>. Add a function to your plugin.py
above your plugin class.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_country_codes</span><span class="p">():</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="s1">&#39;get_site_user&#39;</span><span class="p">)({</span><span class="s1">&#39;ignore_auth&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span> <span class="p">{})</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;country_codes&#39;</span><span class="p">}</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="s1">&#39;vocabulary_show&#39;</span><span class="p">)(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">tk</span><span class="o">.</span><span class="n">ObjectNotFound</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;country_codes&#39;</span><span class="p">}</span>
        <span class="n">vocab</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="s1">&#39;vocabulary_create&#39;</span><span class="p">)(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">u&#39;uk&#39;</span><span class="p">,</span> <span class="s1">u&#39;ie&#39;</span><span class="p">,</span> <span class="s1">u&#39;de&#39;</span><span class="p">,</span> <span class="s1">u&#39;fr&#39;</span><span class="p">,</span> <span class="s1">u&#39;es&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;vocabulary_id&#39;</span><span class="p">:</span> <span class="n">vocab</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]}</span>
            <span class="n">tk</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="s1">&#39;tag_create&#39;</span><span class="p">)(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>This code block is taken from the <tt class="docutils literal"><span class="pre">example_idatsetform</span> <span class="pre">plugin</span></tt>.
<tt class="docutils literal"><span class="pre">create_country_codes</span></tt> tries to fetch the vocabulary country_codes using
<a class="reference internal" href="../api/index.html#ckan.logic.action.get.vocabulary_show" title="ckan.logic.action.get.vocabulary_show"><tt class="xref py py-func docutils literal"><span class="pre">vocabulary_show()</span></tt></a>. If it is not found it will
create it and iterate over the list of countries &#8216;uk&#8217;, &#8216;ie&#8217;, &#8216;de&#8217;, &#8216;fr&#8217;, &#8216;es&#8217;.
For each of these a vocabulary tag is created using
<a class="reference internal" href="../api/index.html#ckan.logic.action.create.tag_create" title="ckan.logic.action.create.tag_create"><tt class="xref py py-func docutils literal"><span class="pre">tag_create()</span></tt></a>, belonging to the vocabulary
<tt class="docutils literal"><span class="pre">country_code</span></tt>.</p>
<p>Although we have only defined five tags here, additional tags can be created
at any point by a sysadmin user by calling
<a class="reference internal" href="../api/index.html#ckan.logic.action.create.tag_create" title="ckan.logic.action.create.tag_create"><tt class="xref py py-func docutils literal"><span class="pre">tag_create()</span></tt></a> using the API or action functions.
Add a second function below <tt class="docutils literal"><span class="pre">create_country_codes</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">country_codes</span><span class="p">():</span>
    <span class="n">create_country_codes</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tag_list</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="s1">&#39;tag_list&#39;</span><span class="p">)</span>
        <span class="n">country_codes</span> <span class="o">=</span> <span class="n">tag_list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;vocabulary_id&#39;</span><span class="p">:</span> <span class="s1">&#39;country_codes&#39;</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">country_codes</span>
    <span class="k">except</span> <span class="n">tk</span><span class="o">.</span><span class="n">ObjectNotFound</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
<p>country_codes will call <tt class="docutils literal"><span class="pre">create_country_codes</span></tt> so that the <tt class="docutils literal"><span class="pre">country_codes</span></tt>
vocabulary is created if it does not exist. Then it calls
<a class="reference internal" href="../api/index.html#ckan.logic.action.get.tag_list" title="ckan.logic.action.get.tag_list"><tt class="xref py py-func docutils literal"><span class="pre">tag_list()</span></tt></a> to return all of our vocabulary tags
together. Now we have a way of retrieving our tag vocabularies and creating
them if they do not exist. We just need our plugin to call this code.</p>
<div class="section" id="adding-tags-to-the-schema">
<h3>Adding tags to the schema<a class="headerlink" href="adding-custom-fields.html#adding-tags-to-the-schema" title="Permalink to this headline">¶</a></h3>
<p>Update <tt class="xref py py-meth docutils literal"><span class="pre">_modify_package_schema()</span></tt>
and <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.show_package_schema" title="ckan.plugins.interfaces.IDatasetForm.show_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">show_package_schema()</span></tt></a></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_modify_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">),</span>
                            <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_to_extras&#39;</span><span class="p">)]</span>
        <span class="p">})</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;country_code&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">),</span>
<span class="hll">                <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_to_tags&#39;</span><span class="p">)(</span><span class="s1">&#39;country_codes&#39;</span><span class="p">)</span>
</span>            <span class="p">]</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">schema</span>

    <span class="k">def</span> <span class="nf">show_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExampleIDatasetFormPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">show_package_schema</span><span class="p">()</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_from_extras&#39;</span><span class="p">),</span>
                            <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">)]</span>
        <span class="p">})</span>

<span class="hll">        <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">][</span><span class="s1">&#39;__extras&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;free_tags_only&#39;</span><span class="p">))</span>
</span><span class="hll">        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span class="hll">            <span class="s1">&#39;country_code&#39;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">                <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_from_tags&#39;</span><span class="p">)(</span><span class="s1">&#39;country_codes&#39;</span><span class="p">),</span>
</span><span class="hll">                <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">)]</span>
</span><span class="hll">            <span class="p">})</span>
</span>        <span class="k">return</span> <span class="n">schema</span>
</pre></div>
</div>
<p>We are adding our tag to our plugin&#8217;s schema. A converter is required to
convert the field in to our tag in a similar way to how we converted our field
to extras earlier. In
<a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.show_package_schema" title="ckan.plugins.interfaces.IDatasetForm.show_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">show_package_schema()</span></tt></a> we convert
from the tag back again but we have an additional line with another converter
containing
<a class="reference internal" href="validators.html#ckan.logic.converters.free_tags_only" title="ckan.logic.converters.free_tags_only"><tt class="xref py py-func docutils literal"><span class="pre">free_tags_only()</span></tt></a>. We include this line so that
vocab tags are not shown mixed with normal free tags.</p>
</div>
<div class="section" id="adding-tags-to-templates">
<h3>Adding tags to templates<a class="headerlink" href="adding-custom-fields.html#adding-tags-to-templates" title="Permalink to this headline">¶</a></h3>
<p>Add an additional plugin.implements line to to your plugin
to implement the <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.ITemplateHelpers" title="ckan.plugins.interfaces.ITemplateHelpers"><tt class="xref py py-class docutils literal"><span class="pre">ITemplateHelpers</span></tt></a>, we will
need to add a <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.ITemplateHelpers.get_helpers" title="ckan.plugins.interfaces.ITemplateHelpers.get_helpers"><tt class="xref py py-meth docutils literal"><span class="pre">get_helpers()</span></tt></a>
function defined for this interface.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">p</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ITemplateHelpers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_helpers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;country_codes&#39;</span><span class="p">:</span> <span class="n">country_codes</span><span class="p">}</span>
</pre></div>
</div>
<p>Our intention here is to tie our country_code fetching/creation to when they
are used in the templates. Add the code below to
<tt class="docutils literal"><span class="pre">package/snippets/package_metadata_fields.html</span></tt></p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="x">#}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">package_metadata_fields</span> <span class="cp">%}</span><span class="x"></span>

<span class="x">  &lt;div class=&quot;control-group&quot;&gt;</span>
<span class="x">    &lt;label class=&quot;control-label&quot; for=&quot;field-country_code&quot;&gt;</span><span class="cp">{{</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Country Code&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&lt;/label&gt;</span>
<span class="x">    &lt;div class=&quot;controls&quot;&gt;</span>
<span class="x">      &lt;select id=&quot;field-country_code&quot; name=&quot;country_code&quot; data-module=&quot;autocomplete&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">country_code</span> <span class="k">in</span> <span class="nv">h.country_codes</span><span class="o">()</span>  <span class="cp">%}</span><span class="x"></span>
<span class="x">          &lt;option value=&quot;</span><span class="cp">{{</span> <span class="nv">country_code</span> <span class="cp">}}</span><span class="x">&quot; </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">country_code</span> <span class="k">in</span> <span class="nv">data.get</span><span class="o">(</span><span class="s1">&#39;country_code&#39;</span><span class="o">,</span> <span class="o">[])</span> <span class="cp">%}</span><span class="x">selected=&quot;selected&quot;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">&gt;</span><span class="cp">{{</span> <span class="nv">country_code</span> <span class="cp">}}</span><span class="x">&lt;/option&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">      &lt;/select&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">  &lt;/div&gt;</span>

<span class="x">  </span><span class="cp">{{</span> <span class="nb">super</span><span class="o">()</span> <span class="cp">}}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>This adds our country code to our template, here we are using the additional
helper country_codes that we defined in our get_helpers function in our plugin.</p>
</div>
</div>
<div class="section" id="adding-custom-fields-to-resources">
<h2>Adding custom fields to resources<a class="headerlink" href="adding-custom-fields.html#adding-custom-fields-to-resources" title="Permalink to this headline">¶</a></h2>
<p>In order to customize the fields in a resource the schema for resources needs
to be modified in a similar way to the datasets. The resource schema
is nested in the dataset dict as package[&#8216;resources&#8217;]. We modify this dict in
a similar way to the dataset schema. Change <tt class="docutils literal"><span class="pre">_modify_package_schema</span></tt> to the
following.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">_modify_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">):</span>
        <span class="c1"># Add our custom country_code metadata field to the schema.</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;country_code&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">),</span>
                    <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_to_tags&#39;</span><span class="p">)(</span><span class="s1">&#39;country_codes&#39;</span><span class="p">)]</span>
                <span class="p">})</span>
        <span class="c1"># Add our custom_test metadata field to the schema, this one will use</span>
        <span class="c1"># convert_to_extras instead of convert_to_tags.</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">),</span>
                    <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_to_extras&#39;</span><span class="p">)]</span>
                <span class="p">})</span>
        <span class="c1"># Add our custom_resource_text metadata field to the schema</span>
<span class="hll">        <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span class="hll">                <span class="s1">&#39;custom_resource_text&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">)</span> <span class="p">]</span>
</span><span class="hll">                <span class="p">})</span>
</span>        <span class="k">return</span> <span class="n">schema</span>
</pre></div>
</div>
<p>Update <a class="reference internal" href="plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.show_package_schema" title="ckan.plugins.interfaces.IDatasetForm.show_package_schema"><tt class="xref py py-meth docutils literal"><span class="pre">show_package_schema()</span></tt></a>
similarly</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">show_package_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ExampleIDatasetFormPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">show_package_schema</span><span class="p">()</span>

        <span class="c1"># Don&#39;t show vocab tags mixed in with normal &#39;free&#39; tags</span>
        <span class="c1"># (e.g. on dataset pages, or on the search page)</span>
        <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">][</span><span class="s1">&#39;__extras&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;free_tags_only&#39;</span><span class="p">))</span>

        <span class="c1"># Add our custom country_code metadata field to the schema.</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;country_code&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_from_tags&#39;</span><span class="p">)(</span><span class="s1">&#39;country_codes&#39;</span><span class="p">),</span>
                <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">)]</span>
            <span class="p">})</span>

        <span class="c1"># Add our custom_text field to the dataset schema.</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;custom_text&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">tk</span><span class="o">.</span><span class="n">get_converter</span><span class="p">(</span><span class="s1">&#39;convert_from_extras&#39;</span><span class="p">),</span>
                <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">)]</span>
            <span class="p">})</span>
<span class="hll">
</span><span class="hll">        <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;resources&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span class="hll">                <span class="s1">&#39;custom_resource_text&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="n">tk</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="s1">&#39;ignore_missing&#39;</span><span class="p">)</span> <span class="p">]</span>
</span><span class="hll">            <span class="p">})</span>
</span>        <span class="k">return</span> <span class="n">schema</span>

    <span class="c1"># These methods just record how many times they&#39;re called, for testing</span>
    <span class="c1"># purposes.</span>
    <span class="c1"># TODO: It might be better to test that custom templates returned by</span>
    <span class="c1"># these methods are actually used, not just that the methods get</span>
    <span class="c1"># called.</span>
</pre></div>
</div>
<p>Save and reload your development server CKAN will take any additional keys from
the resource schema and save them the its extras field.  The templates will
automatically check this field and display them in the resource_read page.</p>
</div>
<div class="section" id="sorting-by-custom-fields-on-the-dataset-search-page">
<h2>Sorting by custom fields on the dataset search page<a class="headerlink" href="adding-custom-fields.html#sorting-by-custom-fields-on-the-dataset-search-page" title="Permalink to this headline">¶</a></h2>
<p>Now that we&#8217;ve added our custom field, we can customize the CKAN web front end
search page to sort datasets by our custom field. Add a new file called
<tt class="docutils literal"><span class="pre">ckanext-extrafields/ckanext/extrafields/templates/package/search.html</span></tt> containing:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">ckan_extends</span> <span class="cp">%}</span><span class="x"></span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">form</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">set</span> <span class="nv">facets</span> <span class="o">=</span> <span class="o">{</span>
    <span class="s1">&#39;fields&#39;</span><span class="o">:</span> <span class="nv">c.fields_grouped</span><span class="o">,</span>
    <span class="s1">&#39;search&#39;</span><span class="o">:</span> <span class="nv">c.search_facets</span><span class="o">,</span>
    <span class="s1">&#39;titles&#39;</span><span class="o">:</span> <span class="nv">c.facet_titles</span><span class="o">,</span>
    <span class="s1">&#39;translated_fields&#39;</span><span class="o">:</span> <span class="nv">c.translated_fields</span><span class="o">,</span>
    <span class="s1">&#39;remove_field&#39;</span><span class="o">:</span> <span class="nv">c.remove_field</span> <span class="o">}</span>
  <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">set</span> <span class="nv">sorting</span> <span class="o">=</span> <span class="o">[</span>
    <span class="o">(</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Relevance&#39;</span><span class="o">),</span> <span class="s1">&#39;score desc, metadata_modified desc&#39;</span><span class="o">),</span>
    <span class="o">(</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Name Ascending&#39;</span><span class="o">),</span> <span class="s1">&#39;title_string asc&#39;</span><span class="o">),</span>
    <span class="o">(</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Name Descending&#39;</span><span class="o">),</span> <span class="s1">&#39;title_string desc&#39;</span><span class="o">),</span>
    <span class="o">(</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Last Modified&#39;</span><span class="o">),</span> <span class="s1">&#39;metadata_modified desc&#39;</span><span class="o">),</span>
<span class="hll">    <span class="o">(</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Custom Field Ascending&#39;</span><span class="o">),</span> <span class="s1">&#39;custom_text asc&#39;</span><span class="o">),</span>
</span><span class="hll">    <span class="o">(</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Custom Field Descending&#39;</span><span class="o">),</span> <span class="s1">&#39;custom_text desc&#39;</span><span class="o">),</span>
</span>    <span class="o">(</span><span class="kp">_</span><span class="o">(</span><span class="s1">&#39;Popular&#39;</span><span class="o">),</span> <span class="s1">&#39;views_recent desc&#39;</span><span class="o">)</span> <span class="k">if</span> <span class="nv">g.tracking_enabled</span> <span class="k">else</span> <span class="o">(</span><span class="kp">false</span><span class="o">,</span> <span class="kp">false</span><span class="o">)</span> <span class="o">]</span>
  <span class="cp">%}</span><span class="x"></span>
<span class="x">  </span><span class="cp">{%</span> <span class="k">snippet</span> <span class="s1">&#39;snippets/search_form.html&#39;</span><span class="o">,</span> <span class="nv">type</span><span class="o">=</span><span class="s1">&#39;dataset&#39;</span><span class="o">,</span> <span class="nv">query</span><span class="o">=</span><span class="nv">c.q</span><span class="o">,</span> <span class="nv">sorting</span><span class="o">=</span><span class="nv">sorting</span><span class="o">,</span> <span class="nv">sorting_selected</span><span class="o">=</span><span class="nv">c.sort_by_selected</span><span class="o">,</span> <span class="nv">count</span><span class="o">=</span><span class="nv">c.page.item_count</span><span class="o">,</span> <span class="nv">facets</span><span class="o">=</span><span class="nv">facets</span><span class="o">,</span> <span class="nv">show_empty</span><span class="o">=</span><span class="nv">request.params</span><span class="o">,</span> <span class="nv">error</span><span class="o">=</span><span class="nv">c.query_error</span> <span class="cp">%}</span><span class="x"></span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="x"></span>
</pre></div>
</div>
<p>This overrides the search ordering drop down code block, the code is the
same as the default dataset search block but we are adding two additional lines
that define the display name of that search ordering (e.g. Custom Field
Ascending) and the SOLR sort ordering (e.g. custom_text asc). If you reload your
development server you should be able to see these two additional sorting options
on the dataset search page.</p>
<p>The SOLR sort ordering can define arbitrary functions for custom sorting, but
this is beyond the scope of this tutorial for further details see
<a class="reference external" href="http://wiki.apache.org/solr/CommonQueryParameters#sort">http://wiki.apache.org/solr/CommonQueryParameters#sort</a> and
<a class="reference external" href="http://wiki.apache.org/solr/FunctionQuery">http://wiki.apache.org/solr/FunctionQuery</a></p>
<p>You can find the complete source for this tutorial at
<a class="reference external" href="https://github.com/ckan/ckan/tree/master/ckanext/example_idatasetform">https://github.com/ckan/ckan/tree/master/ckanext/example_idatasetform</a></p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation"
         aria-label="footer navigation">
      
        <a href="plugin-interfaces.html" class="btn btn-neutral float-right"
           title="Plugin interfaces reference"/>
           Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="best-practices.html" class="btn btn-neutral"
           title="Best practices for writing extensions">
           <span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr></hr>

  <p>Support the <a href="http://ckan.org">CKAN Association</a>.</p>

  <p class="copyright">
      &copy; 2009-2013, <a href="http://okfn.org/">Open Knowledge Foundation</a>.
    Licensed under <a
    href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
    Attribution ShareAlike (Unported) v3.0 License</a>.<br />
    <img src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" alt="CC License Logo" />
    <a href="http://opendefinition.org/"><img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" border="0"
      alt="{{ _('Open Content') }}" /></a>
  
  </p>

  <p>
    <a href="https://github.com/ckan/ckan">Source</a>
    &mdash;
    <a href="https://github.com/ckan/ckan/issues">Issues</a>
    &mdash;
    <a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">Mailing List</a>
    &mdash;
    <a href="http://twitter.com/CKANProject">Twitter @CKANProject</a>
  </p>

  <p>
    Related Projects:
    <a href="http://thedatahub.org/">The DataHub</a>
    &mdash;
    <a href="http://datacatalogs.org">DataCatalogs.org</a>
    &mdash;
    <a href="http://openspending.org">OpenSpending.org</a>
    &mdash;
    <a href="http://opendatahandbook.org">Open Data Handbook</a>
  </p>


  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a>  provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="../../../index.html">latest</a></dd>
        
          <dd><a href="../../ckan-2.6.0/index.html">ckan-2.6.0</a></dd>
        
          <dd><a href="../../ckan-2.5.3/index.html">ckan-2.5.3</a></dd>
        
          <dd><a href="../../ckan-2.4.4/index.html">ckan-2.4.4</a></dd>
        
          <dd><a href="../../ckan-2.3.5/index.html">ckan-2.3.5</a></dd>
        
          <dd><a href="../../ckan-2.2.3/index.html">ckan-2.2.3</a></dd>
        
          <dd><a href="../../ckan-2.1.5/index.html">ckan-2.1.5</a></dd>
        
          <dd><a href="http://docs.ckan.org/en/ckan-2.0.7/">ckan-2.0.7</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="http://readthedocs.org/projects/ckan/downloads/pdf/latest/">pdf</a></dd>
        
          <dd><a href="http://readthedocs.org/projects/ckan/downloads/htmlzip/latest/">htmlzip</a></dd>
        
          <dd><a href="http://readthedocs.org/projects/ckan/downloads/epub/latest/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="http://readthedocs.org/projects/ckan/?fromdocs=ckan">Project Home</a>
          </dd>
          <dd>
            <a href="http://readthedocs.org/builds/ckan/?fromdocs=ckan">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.7.0a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>