<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DataStore Extension &mdash; CKAN Documentation 2.1.5 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/fix.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="_static/bootstrap-css-tweaks.js"></script>
    <link rel="top" title="CKAN Documentation 2.1.5 documentation" href="index.html" />
    <link rel="up" title="Features" href="features.html" />
    <link rel="next" title="Apps &amp; Ideas" href="apps-ideas.html" />
    <link rel="prev" title="FileStore and File Uploads" href="filestore.html" />


<!-- RTD Extra Head -->



  
  <!-- 
  Always link to the latest version, as canonical.
  http://docs.readthedocs.org/en/latest/canonical.html
  -->
  <link rel="canonical" href="http://docs.ckan.org//en/latest/datastore.html" />
  

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "ckan",
    version: "ckan-2.1.5",
    language: "en",
    page: "datastore",
    builder: "sphinx",
    theme: "sphinx-theme-okfn",
    docroot: "/doc/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org/",
    commit: "1d691ae3ba38a6b98dc69d0e2c16c71e186cd36e"
  }
  // Old variables
  var doc_version = "ckan-2.1.5";
  var doc_slug = "ckan";
  var page_name = "datastore";
  var html_theme = "sphinx-theme-okfn";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->

  </head>
  <body role="document">
  
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        
        <a class="logo-icon pull-left" href="index.html"><img src="http://docs.ckan.org/en/ckan-2.1.5/_static/http://assets.okfn.org/p/opendatahandbook/img/data-wrench-inverted.png" alt="CKAN Documentation" /></a>
        
        <a class="brand" href="index.html">CKAN Documentation<span class="version"> v2.1.5</span></a>
        
        
        <a class="okfn-logo pull-right" href="http://okfn.org/" title="An Open Knowledge Foundation Project">
          <img src="https://s3.amazonaws.com/assets.okfn.org/p/okfn/img/logo_28x30.png" alt="Open Knowledge Foundation logo" />
        </a>
        
        
          
<form class="pull-right navbar-search" action="http://docs.ckan.org/en/ckan-2.1.5/search.html" method="get">
  <input type="text" name="q" placeholder="Search" class="search-query span2" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span4">
      <div class="well sidebar-nav">
        
          
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="filestore.html"
                        title="previous chapter">FileStore and File Uploads</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="apps-ideas.html"
                        title="next chapter">Apps &amp; Ideas</a></p><div class="widget toc">
  <h3>Table of Contents</h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading.html">Upgrading CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="features.html">Features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="paster.html">Command Line Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-viewer.html">Data Viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="filestore.html">FileStore and File Uploads</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="datastore.html">DataStore Extension</a><ul>
<li class="toctree-l3"><a class="reference internal" href="datastore.html#relationship-to-filestore">Relationship to FileStore</a></li>
<li class="toctree-l3"><a class="reference internal" href="datastore.html#setting-up-the-datastore">Setting up the DataStore</a></li>
<li class="toctree-l3"><a class="reference internal" href="datastore.html#the-datastore-api">The DataStore API</a></li>
<li class="toctree-l3"><a class="reference internal" href="datastore.html#datastorer-automatically-add-data-to-the-datastore">DataStorer: Automatically Add Data to the DataStore</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="apps-ideas.html">Apps &amp; Ideas</a></li>
<li class="toctree-l2"><a class="reference internal" href="tag-vocabularies.html">Tag Vocabularies</a></li>
<li class="toctree-l2"><a class="reference internal" href="form-integration.html">Form Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="linked-data-and-rdf.html">Linked Data and RDF</a></li>
<li class="toctree-l2"><a class="reference internal" href="background-tasks.html">Background Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="email-notifications.html">Email Notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracking.html">Page View Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="multilingual.html">Multilingual Extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats.html">Stats Extension</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="writing-extensions.html">Writing Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">The CKAN API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Testing CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Config File Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>

        </div>
      </div>
        
      </div><!--/.well -->
    </div><!--/span-->
    <div class="span8">
      <div class="content">

        
        <div style="font-size:smaller;">
              <a href="index.html">CKAN Documentation 2.1.5 documentation</a> &raquo;
              <a href="features.html"
                    accesskey="U">
                    Features
                  </a>
                   &raquo;
        </div>

        
  <div class="section" id="datastore-extension">
<h1>DataStore Extension<a class="headerlink" href="datastore.html#datastore-extension" title="Permalink to this headline">Â¶</a></h1>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p>What features does the datastore actually provide that users care about?
Why would they want to use it?</p>
<ul class="last simple">
<li>API for reading, writing data without downloading, uploading entire file</li>
<li>Enables Recline previews</li>
<li>API for searching data, including search across resources</li>
</ul>
</div>
<p>The CKAN DataStore provides a database for structured storage of data together
with a powerful Web-accessible Data API, all seamlessly integrated into the CKAN
interface and authorization system. At the same time, we kept the layer between the
underlying database and the user as thin as possible.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="datastore.html#relationship-to-filestore" id="id4">Relationship to FileStore</a></li>
<li><a class="reference internal" href="datastore.html#setting-up-the-datastore" id="id5">Setting up the DataStore</a></li>
<li><a class="reference internal" href="datastore.html#the-datastore-api" id="id6">The DataStore API</a></li>
<li><a class="reference internal" href="datastore.html#datastorer-automatically-add-data-to-the-datastore" id="id7">DataStorer: Automatically Add Data to the DataStore</a></li>
</ul>
</div>
<div class="section" id="relationship-to-filestore">
<h2><a class="toc-backref" href="datastore.html#id4">Relationship to FileStore</a><a class="headerlink" href="datastore.html#relationship-to-filestore" title="Permalink to this headline">Â¶</a></h2>
<p>The DataStore is distinct but complementary to the FileStore (see
<a class="reference internal" href="filestore.html"><em>FileStore and File Uploads</em></a>). In contrast to the the FileStore which provides &#8216;blob&#8217;
storage of whole files with no way to access or query parts of that file, the
DataStore is like a database in which individual data elements are accessible
and queryable. To illustrate this distinction, consider storing a spreadsheet
file like a CSV or Excel document. In the FileStore this file would be stored
directly. To access it you would download the file as a whole. By contrast, if
the spreadsheet data is stored in the DataStore, one would be able to access
individual spreadsheet rows via a simple web API, as well as being able to make
queries over the spreadsheet contents.</p>
</div>
<div class="section" id="setting-up-the-datastore">
<h2><a class="toc-backref" href="datastore.html#id5">Setting up the DataStore</a><a class="headerlink" href="datastore.html#setting-up-the-datastore" title="Permalink to this headline">Â¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The DataStore requires PostgreSQL 9.0 or later. It is possible to use the
DataStore on versions prior to 9.0 (for example 8.4). However, the
<code class="xref py py-meth docutils literal"><span class="pre">datastore_search_sql()</span></code> will not be
available and the set-up is slightly different. Make sure, you read
<a class="reference internal" href="datastore.html#legacy-mode"><span>Legacy mode: use the DataStore with old PostgreSQL versions</span></a> for more details.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The DataStore does not support hiding resources in a private dataset.</p>
</div>
<div class="section" id="enable-the-plugin">
<h3>1. Enable the plugin<a class="headerlink" href="datastore.html#enable-the-plugin" title="Permalink to this headline">Â¶</a></h3>
<p>Add the <code class="docutils literal"><span class="pre">datastore</span></code> plugin to your CKAN config file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ckan</span><span class="o">.</span><span class="n">plugins</span> <span class="o">=</span> <span class="n">datastore</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-the-database">
<h3>2. Set-up the database<a class="headerlink" href="datastore.html#set-up-the-database" title="Permalink to this headline">Â¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Make sure that you follow the steps in <a class="reference internal" href="datastore.html#set-permissions">Set Permissions</a> below correctly. Wrong settings could lead to serious security issues.</p>
</div>
<p>The DataStore requires a separate PostgreSQL database to save the resources to.</p>
<p>List existing databases:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo -u postgres psql -l
</pre></div>
</div>
<p>Check that the encoding of databases is <code class="docutils literal"><span class="pre">UTF8</span></code>, if not internationalisation may be a problem. Since changing the encoding of PostgreSQL may mean deleting existing databases, it is suggested that this is fixed before continuing with the datastore setup.</p>
<div class="section" id="create-users-and-databases">
<h4>Create users and databases<a class="headerlink" href="datastore.html#create-users-and-databases" title="Permalink to this headline">Â¶</a></h4>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>If your CKAN database and DataStore databases are on different servers, then
you need to create a new database user on the server where the DataStore
database will be created. As in <a class="reference internal" href="install-from-source.html"><em>Installing CKAN from Source</em></a> we&#8217;ll name the
database user ckan_default:</p>
<pre class="last literal-block">
sudo -u postgres createuser -S -D -R -P -l ckan_default
</pre>
</div>
<p>Create a database_user called datastore_default. This user will be given
read-only access to your DataStore database in the <a class="reference internal" href="datastore.html#set-permissions">Set Permissions</a> step
below:</p>
<pre class="literal-block">
sudo -u postgres createuser -S -D -R -P -l datastore_default
</pre>
<p>Create the database (owned by ckan_default), which we&#8217;ll call
datastore_default:</p>
<pre class="literal-block">
sudo -u postgres createdb -O ckan_default datastore_default -E utf-8
</pre>
</div>
<div class="section" id="set-urls">
<h4>Set URLs<a class="headerlink" href="datastore.html#set-urls" title="Permalink to this headline">Â¶</a></h4>
<p>Now, uncomment the <a class="reference internal" href="configuration.html#ckan-datastore-write-url"><span>ckan.datastore.write_url</span></a> and
<a class="reference internal" href="configuration.html#ckan-datastore-read-url"><span>ckan.datastore.read_url</span></a> lines in your CKAN config file and edit them
if necessary, for example:</p>
<pre class="literal-block">
ckan.datastore.write_url = postgresql://ckan_default:<a class="reference external" href="mailto:pass&#37;&#52;&#48;localhost/">pass<span>&#64;</span>localhost/</a>datastore_default
ckan.datastore.read_url = postgresql://datastore_default:<a class="reference external" href="mailto:pass&#37;&#52;&#48;localhost/">pass<span>&#64;</span>localhost/</a>datastore_default
</pre>
<p>Replace <code class="docutils literal"><span class="pre">pass</span></code> with the passwords you created for your ckan_default and
datastore_default database users.</p>
</div>
<div class="section" id="set-permissions">
<h4>Set Permissions<a class="headerlink" href="datastore.html#set-permissions" title="Permalink to this headline">Â¶</a></h4>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">See <a class="reference internal" href="datastore.html#legacy-mode"><span>Legacy mode: use the DataStore with old PostgreSQL versions</span></a> if these steps continue to fail or seem too complicated for your set-up. However, keep in mind that the legacy mode is limited in its capabilities.</p>
</div>
<p>Once the DataStore database and the users are created, the permissions on the DataStore and CKAN database have to be set. Since there are different set-ups, there are different ways of setting the permissions. Only <strong>one</strong> of the options should be used.</p>
<div class="section" id="option-1-paster-command">
<h5>Option 1: Paster command<a class="headerlink" href="datastore.html#option-1-paster-command" title="Permalink to this headline">Â¶</a></h5>
<p>This option is preferred if CKAN and PostgreSQL are on the same server.</p>
<p>To set the permissions, use this paster command after you&#8217;ve set the database URLs (make sure to have your virtualenv activated):</p>
<pre class="literal-block">
paster datastore set-permissions postgres -c /etc/ckan/default/development.ini
</pre>
<p>The <code class="docutils literal"><span class="pre">postgres</span></code> in this command should be the name of a postgres
user with permission to create new tables and users, grant permissions, etc.
Typically this user is called &#8220;postgres&#8221;. See <code class="docutils literal"><span class="pre">paster</span> <span class="pre">datastore</span>
<span class="pre">set-permissions</span> <span class="pre">-h</span></code>.</p>
</div>
<div class="section" id="option-2-command-line-tool">
<h5>Option 2: Command line tool<a class="headerlink" href="datastore.html#option-2-command-line-tool" title="Permalink to this headline">Â¶</a></h5>
<p>This option should be used if the CKAN server is different from the database server.</p>
<p>Copy the content from the <code class="docutils literal"><span class="pre">datastore/bin/</span></code> directory to the database server. Then run the command line tool <code class="docutils literal"><span class="pre">datastore_setup.py</span></code> to set the permissions on the database. To see all available options, run:</p>
<div class="highlight-python"><div class="highlight"><pre>python datastore_setup.py -h
</pre></div>
</div>
<p>Once you are confident that you know the right names, set the permissions
(assuming that the CKAN database is called ckan_default and the CKAN PostgreSQL
user is called ckan_default):</p>
<pre class="literal-block">
python datastore_setup.py ckan_default datastore_default ckan_default ckan_default datastore_default -p postgres
</pre>
</div>
<div class="section" id="option-3-sql-script">
<h5>Option 3: SQL script<a class="headerlink" href="datastore.html#option-3-sql-script" title="Permalink to this headline">Â¶</a></h5>
<p>This option is for more complex set-ups and requires understanding of SQL and PostgreSQL.</p>
<p>Copy the <code class="docutils literal"><span class="pre">set_permissions.sql</span></code> file to the server that the database runs on. Make sure you set all variables in the file correctly and comment out the parts that are not needed for you set-up. Then, run the script:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo -u postgres psql postgres -f set_permissions.sql
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="test-the-set-up">
<h3>3. Test the set-up<a class="headerlink" href="datastore.html#test-the-set-up" title="Permalink to this headline">Â¶</a></h3>
<p>The DataStore is now set-up. To test the set-up, (re)start CKAN and run the
following command to list all resources that are in the DataStore:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -X GET &quot;http://127.0.0.1:5000/api/3/action/datastore_search?resource_id=_table_metadata&quot;
</pre></div>
</div>
<p>This should return a JSON page without errors.</p>
<p>To test the whether the set-up allows writing, you can create a new resource in
the DataStore. To do so, run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -X POST http://127.0.0.1:5000/api/3/action/datastore_create -H &quot;Authorization: {YOUR-API-KEY}&quot; -d &#39;{&quot;resource_id&quot;: &quot;{RESOURCE-ID}&quot;, &quot;fields&quot;: [ {&quot;id&quot;: &quot;a&quot;}, {&quot;id&quot;: &quot;b&quot;} ], &quot;records&quot;: [ { &quot;a&quot;: 1, &quot;b&quot;: &quot;xyz&quot;}, {&quot;a&quot;: 2, &quot;b&quot;: &quot;zzz&quot;} ]}&#39;
</pre></div>
</div>
<p>Replace <code class="docutils literal"><span class="pre">{YOUR-API-KEY}</span></code> with a valid API key and <code class="docutils literal"><span class="pre">{RESOURCE-ID}</span></code> with a
resource id of an existing CKAN resource.</p>
<p>A table named after the resource id should have been created on your DataStore
database. Visiting this URL should return a response from the DataStore with
the records inserted above:</p>
<div class="highlight-python"><div class="highlight"><pre>http://127.0.0.1:5000/api/3/action/datastore_search?resource_id={RESOURCE_ID}
</pre></div>
</div>
<p>You can now delete the DataStore table with:</p>
<div class="highlight-python"><div class="highlight"><pre>curl -X POST http://127.0.0.1:5000/api/3/action/datastore_delete -H &quot;Authorization: {YOUR-API-KEY}&quot; -d &#39;{&quot;resource_id&quot;: &quot;{RESOURCE-ID}&quot;}&#39;
</pre></div>
</div>
<p>To find out more about the DataStore API, see <a class="reference internal" href="datastore.html#the-datastore-api">The DataStore API</a>.</p>
</div>
<div class="section" id="legacy-mode-use-the-datastore-with-old-postgresql-versions">
<span id="legacy-mode"></span><h3>Legacy mode: use the DataStore with old PostgreSQL versions<a class="headerlink" href="datastore.html#legacy-mode-use-the-datastore-with-old-postgresql-versions" title="Permalink to this headline">Â¶</a></h3>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The legacy mode can also be used to simplify the set-up since it does not require you to set the permissions or create a separate user.</p>
</div>
<p>The DataStore can be used with a PostgreSQL version prior to 9.0 in <em>legacy mode</em>. Due to the lack of some functionality, the <code class="xref py py-meth docutils literal"><span class="pre">datastore_search_sql()</span></code> and consequently the <a class="reference internal" href="datastore.html#datastore-search-htsql"><span>HTSQL Support</span></a> cannot be used. To enable the legacy mode, remove the declaration of the <code class="docutils literal"><span class="pre">ckan.datastore.read_url</span></code>.</p>
<p>The set-up for legacy mode is analogous to the normal set-up as described above with a few changes and consists of the following steps:</p>
<ol class="arabic simple">
<li>Enable the plugin</li>
<li>The legacy mode is enabled by <strong>not</strong> setting the <code class="docutils literal"><span class="pre">ckan.datastore.read_url</span></code></li>
<li>Set-Up the database<ol class="loweralpha">
<li>Create a separate database</li>
<li>Create a write user on the DataStore database (optional since the CKAN user can be used)</li>
</ol>
</li>
<li>Test the set-up</li>
</ol>
<p>There is no need for a read-only user or special permissions. Therefore the legacy mode can be used for simple set-ups as well.</p>
</div>
</div>
<div class="section" id="the-datastore-api">
<h2><a class="toc-backref" href="datastore.html#id6">The DataStore API</a><a class="headerlink" href="datastore.html#the-datastore-api" title="Permalink to this headline">Â¶</a></h2>
<p>The DataStore API allows tabular data to be stored inside CKAN quickly and
easily. Each resource in a CKAN instance can have an associated DataStore
table. The API for using the DataStore is outlined below.</p>
<div class="section" id="making-a-datastore-api-request">
<h3>Making a DataStore API Request<a class="headerlink" href="datastore.html#making-a-datastore-api-request" title="Permalink to this headline">Â¶</a></h3>
<p>Making a DataStore API request is the same as making an Action API request: you
post a JSON dictionary in an HTTP POST request to an API URL, and the API also
returns its response in a JSON dictionary. See the <a class="reference internal" href="api.html"><em>The CKAN API</em></a> for details.</p>
</div>
<div class="section" id="api-reference">
<h3>API Reference<a class="headerlink" href="datastore.html#api-reference" title="Permalink to this headline">Â¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lists can always be expressed in different ways. It is possible to use lists, comma separated strings or single items. These are valid lists: <code class="docutils literal"><span class="pre">['foo',</span> <span class="pre">'bar']</span></code>, <code class="docutils literal"><span class="pre">'foo,</span> <span class="pre">bar'</span></code>, <code class="docutils literal"><span class="pre">&quot;foo&quot;,</span> <span class="pre">&quot;bar&quot;</span></code> and <code class="docutils literal"><span class="pre">'foo'</span></code>. Additionally, there are several ways to define a boolean value. <code class="docutils literal"><span class="pre">True</span></code>, <code class="docutils literal"><span class="pre">on</span></code> and <code class="docutils literal"><span class="pre">1</span></code> are all vaid boolean values.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The table structure of the DataStore is explained in <a class="reference internal" href="datastore.html#db-internals"><span>Internal structure of the database</span></a>.</p>
</div>
<div class="section" id="download-resource-as-csv">
<span id="dump"></span><h4>Download resource as CSV<a class="headerlink" href="datastore.html#download-resource-as-csv" title="Permalink to this headline">Â¶</a></h4>
<p>A DataStore resource can be downloaded in the <a class="reference external" href="http://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> file format from <code class="docutils literal"><span class="pre">{CKAN-URL}/datastore/dump/{RESOURCE-ID}</span></code>.</p>
</div>
<div class="section" id="fields">
<span id="id1"></span><h4>Fields<a class="headerlink" href="datastore.html#fields" title="Permalink to this headline">Â¶</a></h4>
<p>Fields define the column names and the type of the data in a column. A field is defined as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>{
    &quot;id&quot;:    # a string which defines the column name
    &quot;type&quot;:  # the data type for the column
}
</pre></div>
</div>
<p>Field <strong>types are optional</strong> and will be guessed by the DataStore from the provided data. However, setting the types ensures that future inserts will not fail because of wrong types. See <a class="reference internal" href="datastore.html#valid-types"><span>Field types</span></a> for details on which types are valid.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span>
        <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;int4&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="s">&quot;bar&quot;</span>
        <span class="c"># type is optional</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="records">
<span id="id2"></span><h4>Records<a class="headerlink" href="datastore.html#records" title="Permalink to this headline">Â¶</a></h4>
<p>A record is the data to be inserted in a table and is defined as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>{
    &quot;&lt;id&gt;&quot;:  # data to be set
    # .. more data
}
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s">&quot;bar&quot;</span><span class="p">:</span> <span class="s">&quot;Here&#39;s some text&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">&quot;foo&quot;</span><span class="p">:</span> <span class="mi">42</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="field-types">
<span id="valid-types"></span><h4>Field types<a class="headerlink" href="datastore.html#field-types" title="Permalink to this headline">Â¶</a></h4>
<p>The DataStore supports all types supported by PostgreSQL as well as a few additions. A list of the PostgreSQL types can be found in the <a class="reference external" href="http://www.postgresql.org/docs/9.1/static/datatype.html">type section of the documentation</a>. Below you can find a list of the most common data types. The <code class="docutils literal"><span class="pre">json</span></code> type has been added as a storage for nested data.</p>
<p>In addition to the listed types below, you can also use array types. They are defines by prepending a <code class="docutils literal"><span class="pre">_</span></code> or appending <code class="docutils literal"><span class="pre">[]</span></code> or <code class="docutils literal"><span class="pre">[n]</span></code> where n denotes the length of the array. An arbitrarily long array of integers would be defined as <code class="docutils literal"><span class="pre">int[]</span></code>.</p>
<dl class="docutils">
<dt>text</dt>
<dd>Arbitrary text data, e.g. <code class="docutils literal"><span class="pre">Here's</span> <span class="pre">some</span> <span class="pre">text</span></code>.</dd>
<dt>json</dt>
<dd>Arbitrary nested json data, e.g <code class="docutils literal"><span class="pre">{&quot;foo&quot;:</span> <span class="pre">42,</span> <span class="pre">&quot;bar&quot;:</span> <span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]}</span></code>.
Please note that this type is a custom type that is wrapped by the DataStore.</dd>
<dt>date</dt>
<dd>Date without time, e.g <code class="docutils literal"><span class="pre">2012-5-25</span></code>.</dd>
<dt>time</dt>
<dd>Time without date, e.g <code class="docutils literal"><span class="pre">12:42</span></code>.</dd>
<dt>timestamp</dt>
<dd>Date and time, e.g <code class="docutils literal"><span class="pre">2012-10-01T02:43Z</span></code>.</dd>
<dt>int</dt>
<dd>Integer numbers, e.g <code class="docutils literal"><span class="pre">42</span></code>, <code class="docutils literal"><span class="pre">7</span></code>.</dd>
<dt>float</dt>
<dd>Floats, e.g. <code class="docutils literal"><span class="pre">1.61803</span></code>.</dd>
<dt>bool</dt>
<dd>Boolean values, e.g. <code class="docutils literal"><span class="pre">true</span></code>, <code class="docutils literal"><span class="pre">0</span></code></dd>
</dl>
<p>You can find more information about the formatting of dates in the <a class="reference external" href="http://www.postgresql.org/docs/9.1/static/datatype-datetime.html">date/time types section of the PostgreSQL documentation</a>.</p>
</div>
<div class="section" id="resource-aliases">
<span id="id3"></span><h4>Resource aliases<a class="headerlink" href="datastore.html#resource-aliases" title="Permalink to this headline">Â¶</a></h4>
<p>A resource in the DataStore can have multiple aliases that are easier to remember than the resource id. Aliases can be created and edited with the <code class="xref py py-meth docutils literal"><span class="pre">datastore_create()</span></code> API endpoint. All aliases can be found in a special view called <code class="docutils literal"><span class="pre">_table_metadata</span></code>. See <a class="reference internal" href="datastore.html#db-internals"><span>Internal structure of the database</span></a> for full reference.</p>
</div>
<div class="section" id="htsql-support">
<span id="datastore-search-htsql"></span><h4>HTSQL Support<a class="headerlink" href="datastore.html#htsql-support" title="Permalink to this headline">Â¶</a></h4>
<p>The <a class="reference external" href="https://github.com/okfn/ckanext-htsql">ckanext-htsql</a> extension adds an API action that allows a user to search data in a resource using the <a class="reference external" href="http://htsql.org/doc/">HTSQL</a> query expression language. Please refer to the extension documentation to know more.</p>
</div>
<div class="section" id="comparison-of-different-querying-methods">
<span id="comparison-querying"></span><h4>Comparison of different querying methods<a class="headerlink" href="datastore.html#comparison-of-different-querying-methods" title="Permalink to this headline">Â¶</a></h4>
<p>The DataStore supports querying with multiple API endpoints. They are similar but support different features. The following list gives an overview of the different methods.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="31%" />
<col width="33%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"></th>
<th class="head"><code class="xref py py-meth docutils literal"><span class="pre">datastore_search()</span></code></th>
<th class="head"><code class="xref py py-meth docutils literal"><span class="pre">datastore_search_sql()</span></code></th>
<th class="head"><a class="reference internal" href="datastore.html#datastore-search-htsql"><span>HTSQL</span></a></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Ease of use</strong></td>
<td>Easy</td>
<td>Complex</td>
<td>Medium</td>
</tr>
<tr class="row-odd"><td><strong>Flexibility</strong></td>
<td>Low</td>
<td>High</td>
<td>Medium</td>
</tr>
<tr class="row-even"><td><strong>Query language</strong></td>
<td>Custom (JSON)</td>
<td>SQL</td>
<td>HTSQL</td>
</tr>
<tr class="row-odd"><td><strong>Join resources</strong></td>
<td>No</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="internal-structure-of-the-database">
<span id="db-internals"></span><h4>Internal structure of the database<a class="headerlink" href="datastore.html#internal-structure-of-the-database" title="Permalink to this headline">Â¶</a></h4>
<p>The DataStore is a thin layer on top of a PostgreSQL database. Each DataStore resource belongs to a CKAN resource. The name of a table in the DataStore is always the resource id of the CKAN resource for the data.</p>
<p>As explained in <a class="reference internal" href="datastore.html#resource-aliases"><span>Resource aliases</span></a>, a resource can have mnemonic aliases which are stored as views in the database.</p>
<p>All aliases (views) and resources (tables respectively relations) of the DataStore can be found in a special view called <code class="docutils literal"><span class="pre">_table_metadata</span></code>. To access the list, open <code class="docutils literal"><span class="pre">http://{YOUR-CKAN-INSTALLATION}/api/3/action/datastore_search?resource_id=_table_metadata</span></code>.</p>
<p><code class="docutils literal"><span class="pre">_table_metadata</span></code> has the following fields:</p>
<dl class="docutils">
<dt>_id</dt>
<dd>Unique key of the relation in <code class="docutils literal"><span class="pre">_table_metadata</span></code>.</dd>
<dt>alias_of</dt>
<dd>Name of a relation that this alias point to. This field is <code class="docutils literal"><span class="pre">null</span></code> iff the name is not an alias.</dd>
<dt>name</dt>
<dd>Contains the name of the alias if alias_of is not null. Otherwise, this is the resource id of the CKAN resource for the DataStore resource.</dd>
<dt>oid</dt>
<dd>The PostgreSQL object ID of the table that belongs to name.</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="datastorer-automatically-add-data-to-the-datastore">
<span id="datastorer"></span><h2><a class="toc-backref" href="datastore.html#id7">DataStorer: Automatically Add Data to the DataStore</a><a class="headerlink" href="datastore.html#datastorer-automatically-add-data-to-the-datastore" title="Permalink to this headline">Â¶</a></h2>
<p>Often, one wants data that is added to CKAN (whether it is linked to or
uploaded to the <a class="reference internal" href="filestore.html"><em>FileStore</em></a>) to be automatically added to the
DataStore. This requires some processing, to extract the data from your files
and to add it to the DataStore in the format the DataStore can handle.</p>
<p>This task of automatically parsing and then adding data to the DataStore is
performed by a DataStorer, a queue process that runs asynchronously and can be
triggered by uploads or other activities. The DataStorer is an extension and can
be found, along with installation instructions, at: <a class="reference external" href="https://github.com/okfn/ckanext-datastorer">https://github.com/okfn/ckanext-datastorer</a></p>
</div>
</div>



        
        <div style="font-size:smaller;">
          <hr/>
          
            
          
            
              <div class="pull-right">
                <a href="apps-ideas.html"
                  title="Apps &amp; Ideas" accesskey="N">
                    
                      
                    
                    Apps &amp; Ideasâ
                </a>
              </div>
            
          
            
              <div >
                <a href="filestore.html"
                  title="FileStore and File Uploads" accesskey="P">
                    
                      
                    
                    â FileStore and File Uploads
                </a>
              </div>
            
          
          <div style="clear:both;"></div>
        </div>

      </div>
    </div>
  </div> <!-- / row -->
</div>

<footer>
  <div class="inner">
    <div class="container-fluid">
      <p>An <a href="http://okfn.org">Open Knowledge Foundation</a> project.</p>

<p class="copyright">
  &copy; 2009-2012, <a href="http://okfn.org/">Open Knowledge Foundation</a>.
    Licensed under <a
    href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
    Attribution ShareAlike (Unported) v3.0 License</a>.<br />
    <img src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" alt="CC License Logo" />
    <a href="http://opendefinition.org/"><img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" border="0" 
      alt="{{ _('Open Content') }}" /></a>
  <br/>
</p>

<p>
<a href="https://github.com/okfn/ckan">Source</a>
&mdash;
<a href="https://github.com/okfn/ckan/issues">Issues</a>
&mdash;
<a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">Mailing List</a>
&mdash;
<a href="http://twitter.com/CKANProject">Twitter @CKANProject</a>
</p>

<p>
Related Projects:
<a href="http://thedatahub.org/">The DataHub</a>
&mdash;
<a href="http://datacatalogs.org">DataCatalogs.org</a>
&mdash;
<a href="http://openspending.org">OpenSpending.org</a>
&mdash;
<a href="http://opendatahandbook.org">Open Data Handbook</a>
</p>

    </div>
  </div>
</footer>



  </body>
</html>