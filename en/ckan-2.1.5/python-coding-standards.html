<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python Coding Standards &mdash; CKAN Documentation 2.1.5 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/fix.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="_static/bootstrap-css-tweaks.js"></script>
    <link rel="top" title="CKAN Documentation 2.1.5 documentation" href="index.html" />
    <link rel="up" title="Contributing to CKAN" href="contributing.html" />
    <link rel="next" title="HTML Coding Standards" href="html-coding-standards.html" />
    <link rel="prev" title="Creating a new migration script" href="migration.html" />


<!-- RTD Extra Head -->



  
  <!-- 
  Always link to the latest version, as canonical.
  http://docs.readthedocs.org/en/latest/canonical.html
  -->
  <link rel="canonical" href="http://docs.ckan.org//en/latest/python-coding-standards.html" />
  

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "ckan",
    version: "ckan-2.1.5",
    language: "en",
    page: "python-coding-standards",
    builder: "sphinx",
    theme: "sphinx-theme-okfn",
    docroot: "/doc/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org/",
    commit: "1d691ae3ba38a6b98dc69d0e2c16c71e186cd36e"
  }
  // Old variables
  var doc_version = "ckan-2.1.5";
  var doc_slug = "ckan";
  var page_name = "python-coding-standards";
  var html_theme = "sphinx-theme-okfn";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->

  </head>
  <body role="document">
  
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        
        <a class="logo-icon pull-left" href="index.html"><img src="http://docs.ckan.org/en/ckan-2.1.5/_static/http://assets.okfn.org/p/opendatahandbook/img/data-wrench-inverted.png" alt="CKAN Documentation" /></a>
        
        <a class="brand" href="index.html">CKAN Documentation<span class="version"> v2.1.5</span></a>
        
        
        <a class="okfn-logo pull-right" href="http://okfn.org/" title="An Open Knowledge Foundation Project">
          <img src="https://s3.amazonaws.com/assets.okfn.org/p/okfn/img/logo_28x30.png" alt="Open Knowledge Foundation logo" />
        </a>
        
        
          
<form class="pull-right navbar-search" action="http://docs.ckan.org/en/ckan-2.1.5/search.html" method="get">
  <input type="text" name="q" placeholder="Search" class="search-query span2" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span4">
      <div class="well sidebar-nav">
        
          
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="migration.html"
                        title="previous chapter">Creating a new migration script</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="html-coding-standards.html"
                        title="next chapter">HTML Coding Standards</a></p><div class="widget toc">
  <h3>Table of Contents</h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading.html">Upgrading CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing-extensions.html">Writing Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">The CKAN API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Testing CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Config File Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>

        </div>
      </div>
        
      </div><!--/.well -->
    </div><!--/span-->
    <div class="span8">
      <div class="content">

        
        <div style="font-size:smaller;">
              <a href="index.html">CKAN Documentation 2.1.5 documentation</a> &raquo;
              <a href="contributing.html"
                    accesskey="U">
                    Contributing to CKAN
                  </a>
                   &raquo;
        </div>

        
  <div class="section" id="python-coding-standards">
<h1>Python Coding Standards<a class="headerlink" href="python-coding-standards.html#python-coding-standards" title="Permalink to this headline">¶</a></h1>
<p>For Python code style follow <a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">PEP 8</a> plus the guidelines below.</p>
<p>Some good links about Python code style:</p>
<ul class="simple">
<li><a class="reference external" href="http://lists.osafoundation.org/pipermail/dev/2003-March/000479.html">Python Coding Standards</a> from Yahoo</li>
<li><a class="reference external" href="http://google-styleguide.googlecode.com/svn/trunk/pyguide.html">Google Python Style Guide</a></li>
</ul>
<div class="section" id="commit-formatting-cleanups-on-master">
<h2>Commit Formatting Cleanups on master<a class="headerlink" href="python-coding-standards.html#commit-formatting-cleanups-on-master" title="Permalink to this headline">¶</a></h2>
<p>Clean up formatting and PEP 8 issues on master, not on a feature branch.
Unless of course you&#8217;re changing that piece of code anyway.  This will help
avoid spurious merge conflicts, and aid in reading pull requests.</p>
</div>
<div class="section" id="use-single-quotes">
<h2>Use Single Quotes<a class="headerlink" href="python-coding-standards.html#use-single-quotes" title="Permalink to this headline">¶</a></h2>
<p>Use single-quotes for string literals, e.g. <code class="docutils literal"><span class="pre">'my-identifier'</span></code>, <em>but</em> use
double-quotes for strings that are likely to contain single-quote characters as
part of the string itself (such as error messages, or any strings containing
natural language), e.g.  <code class="docutils literal"><span class="pre">&quot;You've</span> <span class="pre">got</span> <span class="pre">an</span> <span class="pre">error!&quot;</span></code>.</p>
<p>Single-quotes are easier to read and to type, but if a string contains
single-quote characters then double-quotes are better than escaping the
single-quote characters or wrapping the string in double single-quotes.</p>
<p>We also use triple single-quotes for docstrings, see <a class="reference internal" href="python-coding-standards.html#docstrings">Docstrings</a>.</p>
</div>
<div class="section" id="imports">
<span id="id2"></span><h2>Imports<a class="headerlink" href="python-coding-standards.html#imports" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Don&#8217;t use <code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> or <code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">name</span></code>. Instead
just <code class="docutils literal"><span class="pre">import</span> <span class="pre">module</span></code> and then access names with <code class="docutils literal"><span class="pre">module.name</span></code>.
See <a class="reference external" href="http://docs.python.org/2/howto/doanddont.html">Idioms and Anti-Idioms in Python</a>.</p>
<p>You can make long module names more concise by aliasing them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">foo.bar.baz</span> <span class="kn">as</span> <span class="nn">baz</span>
</pre></div>
</div>
<p>and then access it with <code class="docutils literal"><span class="pre">baz</span></code> in your code.</p>
</li>
<li><p class="first">Make all imports at the start of the file, after the module docstring.
Imports should be grouped in the following order:</p>
<ol class="arabic simple">
<li>Standard library imports</li>
<li>Third-party imports</li>
<li>CKAN imports</li>
</ol>
</li>
</ul>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="python-coding-standards.html#logging" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Keep log messages short.</li>
<li>Don&#8217;t include object representations in the log message.  It <em>is</em> useful
to include a domain model identifier where appropriate.</li>
<li>Choose an appropriate log-level (DEBUG, INFO, ERROR, WARNING or CRITICAL,
see <a class="reference external" href="http://docs.python.org/2/howto/logging.html">Python&#8217;s Logging HOWTO</a>).</li>
</ul>
</div>
<div class="section" id="string-formatting">
<h2>String Formatting<a class="headerlink" href="python-coding-standards.html#string-formatting" title="Permalink to this headline">¶</a></h2>
<p>Don&#8217;t use the old <cite>%s</cite> style string formatting, e.g. <code class="docutils literal"><span class="pre">&quot;i</span> <span class="pre">am</span> <span class="pre">a</span> <span class="pre">%s&quot;</span> <span class="pre">%</span> <span class="pre">sub</span></code>.
This kind of string formatting is not helpful for internationalization and is
going away in Python 3.</p>
<p>Use the <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#str.format">new .format() method</a> instead, and give meaningful names to each
replacement field, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">_</span><span class="p">(</span><span class="s">&#39; ... {foo} ... {bar} ...&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s">&#39;foo-value&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s">&#39;bar-value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="docstrings">
<span id="id3"></span><h2>Docstrings<a class="headerlink" href="python-coding-standards.html#docstrings" title="Permalink to this headline">¶</a></h2>
<p>We want CKAN&#8217;s docstrings to be clear and easy to read for programmers who are
smart and competent but who may not know a lot of CKAN technical jargon and
whose first language may not be English. We also want it to be easy to maintain
the docstrings and keep them up to date with the actual behaviour of the code
as it changes over time. So:</p>
<ul class="simple">
<li>All modules and all public functions, classes and methods exported by a
module should normally have docstrings (see <a class="reference external" href="http://www.python.org/dev/peps/pep-0257/">PEP 257</a>).</li>
<li>Keep docstrings short, describe only what&#8217;s necessary and no more,</li>
<li>Keep docstrings simple: use plain, concise English.</li>
<li>Try to avoid repetition.</li>
</ul>
<div class="section" id="pep-257-docstring-conventions">
<h3>PEP 257 (Docstring Conventions)<a class="headerlink" href="python-coding-standards.html#pep-257-docstring-conventions" title="Permalink to this headline">¶</a></h3>
<p>Generally, follow <a class="reference external" href="http://www.python.org/dev/peps/pep-0257/">PEP 257</a> for docstrings. We&#8217;ll only describe the ways that
CKAN differs from or extends PEP 257 below.</p>
<p>CKAN docstrings deviate from PEP 257 in a couple of ways:</p>
<ul class="simple">
<li>We use <code class="docutils literal"><span class="pre">'''triple</span> <span class="pre">single</span> <span class="pre">quotes'''</span></code> around docstrings, not <code class="docutils literal"><span class="pre">&quot;&quot;&quot;triple</span>
<span class="pre">double</span> <span class="pre">quotes&quot;&quot;&quot;</span></code> (put triple single quotes around one-line docstrings as
well as multi-line ones, it makes them easier to expand later)</li>
<li>We use Sphinx directives for documenting parameters, exceptions and return
values (see below)</li>
</ul>
</div>
<div class="section" id="sphinx-field-lists">
<h3>Sphinx Field Lists<a class="headerlink" href="python-coding-standards.html#sphinx-field-lists" title="Permalink to this headline">¶</a></h3>
<p>Use <a class="reference external" href="http://sphinx.pocoo.org/markup/desc.html#info-field-lists">Sphinx field lists</a> for documenting the parameters, exceptions and
returns of functions:</p>
<ul class="simple">
<li>Use <code class="docutils literal"><span class="pre">:param</span></code> and <code class="docutils literal"><span class="pre">:type</span></code> to describe each parameter</li>
<li>Use <code class="docutils literal"><span class="pre">:returns</span></code> and <code class="docutils literal"><span class="pre">:rtype</span></code> to describe each return</li>
<li>Use <code class="docutils literal"><span class="pre">:raises</span></code> to describe each exception raised</li>
</ul>
<p>Example of a short docstring:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return a list of all packages that have this tag, sorted by name.</span>

<span class="sd">    :rtype: list of ckan.model.package.Package objects</span>

<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Example of a longer docstring:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">search_by_name</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">vocab_id_or_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return all tags whose names contain a given string.</span>

<span class="sd">    By default only free tags (tags which do not belong to any vocabulary)</span>
<span class="sd">    are returned. If the optional argument ``vocab_id_or_name`` is given</span>
<span class="sd">    then only tags from that vocabulary are returned.</span>

<span class="sd">    :param search_term: the string to search for in the tag names</span>
<span class="sd">    :type search_term: string</span>
<span class="sd">    :param vocab_id_or_name: the id or name of the vocabulary to look in</span>
<span class="sd">        (optional, default: None)</span>
<span class="sd">    :type vocab_id_or_name: string</span>

<span class="sd">    :returns: a list of tags that match the search term</span>
<span class="sd">    :rtype: list of ckan.model.tag.Tag objects</span>

<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
<p>The phrases that follow <code class="docutils literal"><span class="pre">:param</span> <span class="pre">foo:</span></code>, <code class="docutils literal"><span class="pre">:type</span> <span class="pre">foo:</span></code>, or <code class="docutils literal"><span class="pre">:returns:</span></code>
should not start with capital letters or end with full stops. These should be
short phrases and not full sentences. If more detail is required put it in the
function description instead.</p>
<p>Indicate optional arguments by ending their descriptions with <code class="docutils literal"><span class="pre">(optional)</span></code> in
brackets. Where relevant also indicate the default value: <code class="docutils literal"><span class="pre">(optional,</span> <span class="pre">default:</span>
<span class="pre">5)</span></code>.</p>
<p>You can also use a little inline <a class="reference external" href="http://docutils.sourceforge.net/docs/user/rst/quickref.html#inline-markup">reStructuredText markup</a> in docstrings, e.g.
<code class="docutils literal"><span class="pre">*stars</span> <span class="pre">for</span> <span class="pre">emphasis*</span></code> or <code class="docutils literal"><span class="pre">``double-backticks</span> <span class="pre">for</span> <span class="pre">literal</span> <span class="pre">text``</span></code></p>
</div>
<div class="section" id="action-api-docstrings">
<span id="id5"></span><h3>Action API Docstrings<a class="headerlink" href="python-coding-standards.html#action-api-docstrings" title="Permalink to this headline">¶</a></h3>
<p>Docstrings from CKAN&#8217;s action API are processed with <a class="reference external" href="http://sphinx.pocoo.org/ext/autodoc.html">autodoc</a> and
included in the API chapter of CKAN&#8217;s documentation. The intended audience of
these docstrings is users of the CKAN API and not (just) CKAN core developers.</p>
<p>In the Python source each API function has the same two arguments (<code class="docutils literal"><span class="pre">context</span></code>
and <code class="docutils literal"><span class="pre">data_dict</span></code>), but the docstrings should document the keys that the
functions read from <code class="docutils literal"><span class="pre">data_dict</span></code> and not <code class="docutils literal"><span class="pre">context</span></code> and <code class="docutils literal"><span class="pre">data_dict</span></code>
themselves, as this is what the user has to POST in the JSON dict when calling
the API.</p>
<p>Where practical, it&#8217;s helpful to give examples of param and return values in
API docstrings.</p>
<p>CKAN datasets used to be called packages and the old name still appears in the
source, e.g. in function names like <code class="docutils literal"><span class="pre">package_list()</span></code>. When documenting
functions like this write dataset not package, but the first time you do this
put package after it in brackets to avoid any confusion, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre>def package_show(context, data_dict):
    &#39;&#39;&#39;Return the metadata of a dataset (package) and its resources.
</pre></div>
</div>
<p>Example of a ckan.logic.action API docstring:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">vocabulary_create</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create a new tag vocabulary.</span>

<span class="sd">    You must be a sysadmin to create vocabularies.</span>

<span class="sd">    :param name: the name of the new vocabulary, e.g. ``&#39;Genre&#39;``</span>
<span class="sd">    :type name: string</span>
<span class="sd">    :param tags: the new tags to add to the new vocabulary, for the format of</span>
<span class="sd">        tag dictionaries see ``tag_create()``</span>
<span class="sd">    :type tags: list of tag dictionaries</span>

<span class="sd">    :returns: the newly-created vocabulary</span>
<span class="sd">    :rtype: dictionary</span>

<span class="sd">    &#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="some-helpful-tools-for-python-code-quality">
<h2>Some Helpful Tools for Python Code Quality<a class="headerlink" href="python-coding-standards.html#some-helpful-tools-for-python-code-quality" title="Permalink to this headline">¶</a></h2>
<p>There are various tools that can help you to check your Python code for PEP8
conformance and general code quality. We recommend using them.</p>
<ul class="simple">
<li><a class="reference external" href="http://pypi.python.org/pypi/pep8">pep8</a> checks your Python code against some of the style conventions in PEP
8. As mentioned above, only perform style clean-ups on master to help avoid
spurious merge conflicts.</li>
<li><a class="reference external" href="http://www.logilab.org/857">pylint</a> analyzes Python source code looking for bugs and signs of poor
quality.</li>
<li><a class="reference external" href="http://pypi.python.org/pypi/pyflakes">pyflakes</a> also analyzes Python programs to detect errors.</li>
<li><a class="reference external" href="http://pypi.python.org/pypi/flake8">flake8</a> combines both pep8 and pyflakes into a single tool.</li>
<li><a class="reference external" href="https://github.com/scrooloose/syntastic">Syntastic</a> is a Vim plugin with support for flake8, pyflakes and pylint.</li>
</ul>
</div>
</div>



        
        <div style="font-size:smaller;">
          <hr/>
          
            
          
            
              <div class="pull-right">
                <a href="html-coding-standards.html"
                  title="HTML Coding Standards" accesskey="N">
                    
                      
                    
                    HTML Coding Standards→
                </a>
              </div>
            
          
            
              <div >
                <a href="migration.html"
                  title="Creating a new migration script" accesskey="P">
                    
                      
                    
                    ← Creating a new migration script
                </a>
              </div>
            
          
          <div style="clear:both;"></div>
        </div>

      </div>
    </div>
  </div> <!-- / row -->
</div>

<footer>
  <div class="inner">
    <div class="container-fluid">
      <p>An <a href="http://okfn.org">Open Knowledge Foundation</a> project.</p>

<p class="copyright">
  &copy; 2009-2012, <a href="http://okfn.org/">Open Knowledge Foundation</a>.
    Licensed under <a
    href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
    Attribution ShareAlike (Unported) v3.0 License</a>.<br />
    <img src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" alt="CC License Logo" />
    <a href="http://opendefinition.org/"><img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" border="0" 
      alt="{{ _('Open Content') }}" /></a>
  <br/>
</p>

<p>
<a href="https://github.com/okfn/ckan">Source</a>
&mdash;
<a href="https://github.com/okfn/ckan/issues">Issues</a>
&mdash;
<a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">Mailing List</a>
&mdash;
<a href="http://twitter.com/CKANProject">Twitter @CKANProject</a>
</p>

<p>
Related Projects:
<a href="http://thedatahub.org/">The DataHub</a>
&mdash;
<a href="http://datacatalogs.org">DataCatalogs.org</a>
&mdash;
<a href="http://openspending.org">OpenSpending.org</a>
&mdash;
<a href="http://opendatahandbook.org">Open Data Handbook</a>
</p>

    </div>
  </div>
</footer>



  </body>
</html>