<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upgrading a CKAN 2 package install to a new minor release &mdash; CKAN Documentation 2.1.5 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/fix.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="_static/bootstrap-css-tweaks.js"></script>
    <link rel="top" title="CKAN Documentation 2.1.5 documentation" href="index.html" />
    <link rel="up" title="Upgrading CKAN" href="upgrading.html" />
    <link rel="next" title="Upgrading a source install" href="upgrade-source.html" />
    <link rel="prev" title="Upgrading a CKAN 2 package install to a new patch release" href="upgrade-package-to-patch-release.html" />


<!-- RTD Extra Head -->



  
  <!-- 
  Always link to the latest version, as canonical.
  http://docs.readthedocs.org/en/latest/canonical.html
  -->
  <link rel="canonical" href="http://docs.ckan.org//en/latest/upgrade-package-to-minor-release.html" />
  

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "ckan",
    version: "ckan-2.1.5",
    language: "en",
    page: "upgrade-package-to-minor-release",
    builder: "sphinx",
    theme: "sphinx-theme-okfn",
    docroot: "/doc/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org/",
    commit: "1d691ae3ba38a6b98dc69d0e2c16c71e186cd36e"
  }
  // Old variables
  var doc_version = "ckan-2.1.5";
  var doc_slug = "ckan";
  var page_name = "upgrade-package-to-minor-release";
  var html_theme = "sphinx-theme-okfn";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->

  </head>
  <body role="document">
  
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        
        <a class="logo-icon pull-left" href="index.html"><img src="http://docs.ckan.org/en/ckan-2.1.5/_static/http://assets.okfn.org/p/opendatahandbook/img/data-wrench-inverted.png" alt="CKAN Documentation" /></a>
        
        <a class="brand" href="index.html">CKAN Documentation<span class="version"> v2.1.5</span></a>
        
        
        <a class="okfn-logo pull-right" href="http://okfn.org/" title="An Open Knowledge Foundation Project">
          <img src="https://s3.amazonaws.com/assets.okfn.org/p/okfn/img/logo_28x30.png" alt="Open Knowledge Foundation logo" />
        </a>
        
        
          
<form class="pull-right navbar-search" action="http://docs.ckan.org/en/ckan-2.1.5/search.html" method="get">
  <input type="text" name="q" placeholder="Search" class="search-query span2" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span4">
      <div class="well sidebar-nav">
        
          
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="upgrade-package-to-patch-release.html"
                        title="previous chapter">Upgrading a CKAN 2 package install to a new patch release</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="upgrade-source.html"
                        title="next chapter">Upgrading a source install</a></p><div class="widget toc">
  <h3>Table of Contents</h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing CKAN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="upgrading.html">Upgrading CKAN</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#ckan-releases">CKAN releases</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#release-process">Release process</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="upgrading.html#upgrading">Upgrading CKAN</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="upgrading.html#backup-your-database">1. Backup your database</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="upgrading.html#upgrade-ckan">2. Upgrade CKAN</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing-extensions.html">Writing Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">The CKAN API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Testing CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Config File Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>

        </div>
      </div>
        
      </div><!--/.well -->
    </div><!--/span-->
    <div class="span8">
      <div class="content">

        
        <div style="font-size:smaller;">
              <a href="index.html">CKAN Documentation 2.1.5 documentation</a> &raquo;
              <a href="upgrading.html"
                    accesskey="U">
                    Upgrading CKAN
                  </a>
                   &raquo;
        </div>

        
  <div class="section" id="upgrading-a-ckan-2-package-install-to-a-new-minor-release">
<h1>Upgrading a CKAN 2 package install to a new minor release<a class="headerlink" href="upgrade-package-to-minor-release.html#upgrading-a-ckan-2-package-install-to-a-new-minor-release" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before upgrading CKAN you should check the compatibility of any custom
themes or extensions you&#8217;re using, check the changelog, and backup your
database. See <a class="reference internal" href="upgrading.html#upgrading"><span>Upgrading CKAN</span></a>.</p>
</div>
<p>Each <a class="reference internal" href="upgrading.html#releases"><span>minor release</span></a> is distributed in its own package,
so for example CKAN <code class="docutils literal"><span class="pre">2.0.X</span></code> and <code class="docutils literal"><span class="pre">2.1.X</span></code> will be installed using the
<code class="docutils literal"><span class="pre">python-ckan_2.0_amd64.deb</span></code> and <code class="docutils literal"><span class="pre">python-ckan_2.1_amd64.deb</span></code> packages
respectively.</p>
<ol class="arabic">
<li><p class="first">Download the CKAN package for the new minor release you want to upgrade
to (replace the version number with the relevant one):</p>
<div class="highlight-python"><div class="highlight"><pre>wget http://packaging.ckan.org/python-ckan_2.1_amd64.deb
</pre></div>
</div>
</li>
<li><p class="first">Install the package with the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo dpkg -i python-ckan_2.1_amd64.deb
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you have changed the Apache or Nginx configuration files, you will
get a prompt like the following, asking whether to keep your local changes
or replace the files. You generally would like to keep your local changes
(option <code class="docutils literal"><span class="pre">N</span></code>, which is the default), but you can look at the differences
between versions by selecting option <code class="docutils literal"><span class="pre">D</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>Configuration file `/etc/apache2/sites-available/ckan_default&#39;
 ==&gt; File on system created by you or by a script.
 ==&gt; File also in package provided by package maintainer.
   What would you like to do about it ?  Your options are:
    Y or I  : install the package maintainer&#39;s version
    N or O  : keep your currently-installed version
      D     : show the differences between the versions
      Z     : start a shell to examine the situation
 The default action is to keep your current version.
*** ckan_default (Y/I/N/O/D/Z) [default=N] ?
</pre></div>
</div>
<p class="last">Your local CKAN configuration file in /etc/ckan/default will not be replaced.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The install process will uninstall any existing CKAN extensions or other
libraries located in the <code class="docutils literal"><span class="pre">src</span></code> directory of the CKAN virtualenv. To
enable them again, the installation process will iterate over all folders in
the <code class="docutils literal"><span class="pre">src</span></code> directory, reinstall the requirements listed in
<code class="docutils literal"><span class="pre">pip-requirements.txt</span></code> and <code class="docutils literal"><span class="pre">requirements.txt</span></code> files and run
<code class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">develop</span></code> for each. If you are using a custom extension
which does not use this requirements file name or is located elsewhere,
you will need to manually reinstall it.</p>
</div>
</li>
<li><p class="first">If there have been changes in the database schema (check the
<a class="reference internal" href="changelog.html"><em>Changelog</em></a> to find out) you need to update your CKAN database&#8217;s
schema using the <code class="docutils literal"><span class="pre">db</span> <span class="pre">upgrade</span></code> command.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">To avoid problems during the database upgrade, comment out any plugins
that you have enabled in your ini file. You can uncomment them again when
the upgrade finishes.</p>
</div>
<p>For example:</p>
<pre class="literal-block">
paster db upgrade --config=/etc/ckan/default/development.ini
</pre>
<p>See <a class="reference internal" href="paster.html#paster-db"><span>db: Manage databases</span></a> for details of the <code class="docutils literal"><span class="pre">db</span> <span class="pre">upgrade</span></code>
command.</p>
</li>
<li><p class="first">If there have been changes in the Solr schema (check the <a class="reference internal" href="changelog.html"><em>Changelog</em></a>
to find out) you need to update your Solr schema symlink.</p>
<p>When <a class="reference internal" href="solr-setup.html#setting-up-solr"><span>Setting up Solr</span></a> you created a symlink
<code class="docutils literal"><span class="pre">/etc/solr/conf/schema.xml</span></code> linking to a CKAN Solr schema file such as
/usr/lib/ckan/default/src/ckan/ckan/config/solr/schema-2.0.xml. This symlink
should be updated to point to the latest schema file in
/usr/lib/ckan/default/src/ckan/ckan/config/solr/, if it doesn&#8217;t already.</p>
<p>For example, to update the symlink:</p>
<pre class="literal-block">
sudo rm /etc/solr/conf/schema.xml
sudo ln -s /usr/lib/ckan/default/src/ckan/ckan/config/solr/schema-2.0.xml /etc/solr/conf/schema.xml
</pre>
<p>You will need to restart Jetty for the changes to take effect:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo service jetty restart
</pre></div>
</div>
</li>
<li><p class="first">If you have any CKAN extensions installed from source, you may need to
checkout newer versions of the extensions that work with the new CKAN
version. Refer to the documentation for each extension. We recommend
disabling all extensions on your ini file and re-enable them one by one
to make sure they are working fine.</p>
</li>
<li><p class="first">Rebuild your search index by running the <code class="docutils literal"><span class="pre">ckan</span> <span class="pre">search-index</span> <span class="pre">rebuild</span></code>
command:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo ckan search-index rebuild -r
</pre></div>
</div>
<p>See <a class="reference internal" href="paster.html#rebuild-search-index"><span>search-index: Rebuild search index</span></a> for details of the
<code class="docutils literal"><span class="pre">ckan</span> <span class="pre">search-index</span> <span class="pre">rebuild</span></code> command.</p>
</li>
<li><p class="first">Finally, restart Apache:</p>
<pre class="literal-block">
sudo service apache2 restart
</pre>
</li>
</ol>
</div>



        
        <div style="font-size:smaller;">
          <hr/>
          
            
          
            
              <div class="pull-right">
                <a href="upgrade-source.html"
                  title="Upgrading a source install" accesskey="N">
                    
                      
                    
                    Upgrading a source install→
                </a>
              </div>
            
          
            
              <div >
                <a href="upgrade-package-to-patch-release.html"
                  title="Upgrading a CKAN 2 package install to a new patch release" accesskey="P">
                    
                      
                    
                    ← Upgrading a CKAN 2 package install to a new patch ...
                </a>
              </div>
            
          
          <div style="clear:both;"></div>
        </div>

      </div>
    </div>
  </div> <!-- / row -->
</div>

<footer>
  <div class="inner">
    <div class="container-fluid">
      <p>An <a href="http://okfn.org">Open Knowledge Foundation</a> project.</p>

<p class="copyright">
  &copy; 2009-2012, <a href="http://okfn.org/">Open Knowledge Foundation</a>.
    Licensed under <a
    href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
    Attribution ShareAlike (Unported) v3.0 License</a>.<br />
    <img src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" alt="CC License Logo" />
    <a href="http://opendefinition.org/"><img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" border="0" 
      alt="{{ _('Open Content') }}" /></a>
  <br/>
</p>

<p>
<a href="https://github.com/okfn/ckan">Source</a>
&mdash;
<a href="https://github.com/okfn/ckan/issues">Issues</a>
&mdash;
<a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">Mailing List</a>
&mdash;
<a href="http://twitter.com/CKANProject">Twitter @CKANProject</a>
</p>

<p>
Related Projects:
<a href="http://thedatahub.org/">The DataHub</a>
&mdash;
<a href="http://datacatalogs.org">DataCatalogs.org</a>
&mdash;
<a href="http://openspending.org">OpenSpending.org</a>
&mdash;
<a href="http://opendatahandbook.org">Open Data Handbook</a>
</p>

    </div>
  </div>
</footer>



  </body>
</html>