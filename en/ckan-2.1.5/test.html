<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Testing CKAN &mdash; CKAN Documentation 2.1.5 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/fix.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/badge_only.css" type="text/css" />
    <link rel="stylesheet" href="https://cdnmedia.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://cdnmedia.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="_static/bootstrap-css-tweaks.js"></script>
    <link rel="top" title="CKAN Documentation 2.1.5 documentation" href="index.html" />
    <link rel="next" title="Config File Options" href="configuration.html" />
    <link rel="prev" title="Documentation guidelines" href="documentation-guidelines.html" />


<!-- RTD Extra Head -->



  
  <!-- 
  Always link to the latest version, as canonical.
  http://docs.readthedocs.org/en/latest/canonical.html
  -->
  <link rel="canonical" href="http://docs.ckan.org//en/latest/test.html" />
  

<script type="text/javascript">
  // This is included here because other places don't have access to the pagename variable.
  var READTHEDOCS_DATA = {
    project: "ckan",
    version: "ckan-2.1.5",
    language: "en",
    page: "test",
    builder: "sphinx",
    theme: "sphinx-theme-okfn",
    docroot: "/doc/",
    source_suffix: ".rst",
    api_host: "https://readthedocs.org/",
    commit: "1d691ae3ba38a6b98dc69d0e2c16c71e186cd36e"
  }
  // Old variables
  var doc_version = "ckan-2.1.5";
  var doc_slug = "ckan";
  var page_name = "test";
  var html_theme = "sphinx-theme-okfn";
</script>
<!-- RTD Analytics Code -->
<!-- Included in the header because you don't have a footer block. -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17997319-1']);
  _gaq.push(['_trackPageview']);


  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
<!-- end RTD Analytics Code -->
<!-- end RTD <extrahead> -->

  </head>
  <body role="document">
  
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        
        <a class="logo-icon pull-left" href="index.html"><img src="http://docs.ckan.org/en/ckan-2.1.5/_static/http://assets.okfn.org/p/opendatahandbook/img/data-wrench-inverted.png" alt="CKAN Documentation" /></a>
        
        <a class="brand" href="index.html">CKAN Documentation<span class="version"> v2.1.5</span></a>
        
        
        <a class="okfn-logo pull-right" href="http://okfn.org/" title="An Open Knowledge Foundation Project">
          <img src="https://s3.amazonaws.com/assets.okfn.org/p/okfn/img/logo_28x30.png" alt="Open Knowledge Foundation logo" />
        </a>
        
        
          
<form class="pull-right navbar-search" action="http://docs.ckan.org/en/ckan-2.1.5/search.html" method="get">
  <input type="text" name="q" placeholder="Search" class="search-query span2" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span4">
      <div class="well sidebar-nav">
        
          
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="documentation-guidelines.html"
                        title="previous chapter">Documentation guidelines</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="next chapter">Config File Options</a></p><div class="widget toc">
  <h3>Table of Contents</h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading.html">Upgrading CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing-extensions.html">Writing Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">The CKAN API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to CKAN</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="test.html">Testing CKAN</a><ul>
<li class="toctree-l2"><a class="reference internal" href="test.html#installing-additional-dependencies">Installing Additional Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html#testing-with-sqlite">Testing with SQLite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="test.html#testing-core-extensions">Testing Core Extensions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="test.html#testing-with-postgresql">Testing with PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html#migration-testing">Migration Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="test.html#common-error-messages">Common error messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="test.html#configerror">ConfigError</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html#operationalerror">OperationalError</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html#nosetests">nosetests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="test.html#front-end-testing">Front-end Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="test.html#install-browser-virtual-machines">Install browser virtual machines</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html#testing-methodology">Testing methodology</a></li>
<li class="toctree-l3"><a class="reference internal" href="test.html#common-pitfalls-their-fixes">Common pitfalls &amp; their fixes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Config File Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>

        </div>
      </div>
        
      </div><!--/.well -->
    </div><!--/span-->
    <div class="span8">
      <div class="content">

        
        <div style="font-size:smaller;">
              <a href="index.html">CKAN Documentation 2.1.5 documentation</a> &raquo;
        </div>

        
  <div class="section" id="testing-ckan">
<h1>Testing CKAN<a class="headerlink" href="test.html#testing-ckan" title="Permalink to this headline">¶</a></h1>
<p>If you&#8217;re a CKAN developer, if you&#8217;re developing an extension for CKAN, or if
you&#8217;re just installing CKAN from source, you should make sure that CKAN&#8217;s tests
pass for your copy of CKAN. This section explains how to run CKAN&#8217;s tests.</p>
<div class="section" id="installing-additional-dependencies">
<span id="basic-tests"></span><h2>Installing Additional Dependencies<a class="headerlink" href="test.html#installing-additional-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Some additional dependencies are needed to run the tests. Make sure you&#8217;ve
created a config file at /etc/ckan/default/development.ini, then activate your
virtual environment:</p>
<pre class="literal-block">
. /usr/lib/ckan/default/bin/activate
</pre>
<p>Install nose and other test-specific CKAN dependencies into your virtual
environment:</p>
<pre class="literal-block">
pip install -r /usr/lib/ckan/default/src/ckan/dev-requirements.txt
</pre>
</div>
<div class="section" id="testing-with-sqlite">
<h2>Testing with SQLite<a class="headerlink" href="test.html#testing-with-sqlite" title="Permalink to this headline">¶</a></h2>
<p>To run the CKAN tests using SQLite as the database library:</p>
<pre class="literal-block">
cd /usr/lib/ckan/default/src/ckan
nosetests --ckan ckan
</pre>
<p>You <em>must</em> run the tests from the CKAN directory as shown above, otherwise the
<code class="docutils literal"><span class="pre">--ckan</span></code> plugin won&#8217;t work correctly.</p>
<p>In deployment CKAN uses PostgreSQL, not SQLite. Running the tests with SQLite
is less thorough but much quicker than with PostgreSQL, good enough for an
initial check but you should run the tests with PostgreSQL before deploying
anything or releasing any code.</p>
<div class="section" id="testing-core-extensions">
<h3>Testing Core Extensions<a class="headerlink" href="test.html#testing-core-extensions" title="Permalink to this headline">¶</a></h3>
<p>CKAN&#8217;s core extensions (those extensions that are kept in the CKAN codebase
alongside CKAN itself) have their own tests. For example, to run the tests for
the stats extension do:</p>
<div class="highlight-python"><div class="highlight"><pre>nosetests --ckan ckanext/stats
</pre></div>
</div>
<p>To run the tests for all of the core extensions at once:</p>
<div class="highlight-python"><div class="highlight"><pre>nosetests --ckan ckanext
</pre></div>
</div>
<p>Or to run the CKAN tests and the core extensions tests together:</p>
<div class="highlight-python"><div class="highlight"><pre>nosetests --ckan ckan ckanext
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-with-postgresql">
<h2>Testing with PostgreSQL<a class="headerlink" href="test.html#testing-with-postgresql" title="Permalink to this headline">¶</a></h2>
<div class="versionchanged">
<p><span class="versionmodified">Changed in version 2.1: </span>Previously PostgreSQL tests used the databases defined in your
<code class="docutils literal"><span class="pre">development.ini</span></code> file, instead of using their own test databases.</p>
</div>
<p>Create test databases:</p>
<pre class="literal-block">
sudo -u postgres createdb -O ckan_default ckan_test -E utf-8
sudo -u postgres createdb -O ckan_default datastore_test -E utf-8
paster datastore set-permissions postgres -c test-core.ini
</pre>
<p>This database connection is specified in the <code class="docutils literal"><span class="pre">test-core.ini</span></code> file by the
<code class="docutils literal"><span class="pre">sqlalchemy.url</span></code> parameter.</p>
<p>CKAN&#8217;s default nose configuration file (<code class="docutils literal"><span class="pre">test.ini</span></code>) specifies SQLite as the
database library (it also sets <code class="docutils literal"><span class="pre">faster_db_test_hacks</span></code>). To run the tests more
thoroughly with PostgreSQL, specify the <code class="docutils literal"><span class="pre">test-core.ini</span></code> nose configuration
file instead, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>nosetests --ckan --with-pylons=test-core.ini ckan
nosetests --ckan --with-pylons=test-core.ini ckanext/stats
nosetests --ckan --with-pylons=test-core.ini ckanext
nosetests --ckan --with-pylons=test-core.ini ckan ckanext
</pre></div>
</div>
<p>The speed of the PostgreSQL tests can be improved by running PostgreSQL in
memory and turning off durability, as described
<a class="reference external" href="http://www.postgresql.org/docs/9.0/static/non-durability.html">in the PostgreSQL documentation</a>.</p>
</div>
<div class="section" id="migration-testing">
<span id="migrationtesting"></span><h2>Migration Testing<a class="headerlink" href="test.html#migration-testing" title="Permalink to this headline">¶</a></h2>
<p>If you&#8217;re a CKAN developer or extension developer and your new code requires a
change to CKAN&#8217;s model, you&#8217;ll need to write a migration script. To ensure that
the migration script itself gets tested, you should run the tests with
they <code class="docutils literal"><span class="pre">--ckan-migration</span></code> option, for example:</p>
<div class="highlight-python"><div class="highlight"><pre>nosetests --ckan --ckan-migration --with-pylons=test-core.ini ckan
</pre></div>
</div>
<p>By default tests are run using the model defined in <code class="docutils literal"><span class="pre">ckan/model</span></code>.
With the <code class="docutils literal"><span class="pre">--ckan-migration</span></code> option the tests will run using a database that
has been created by running the migration scripts in <code class="docutils literal"><span class="pre">ckan/migration</span></code>, which
is how the database is created and upgraded in production.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">A common error when wanting to run tests against a particular database is to
change <code class="docutils literal"><span class="pre">sqlalchemy.url</span></code> in <code class="docutils literal"><span class="pre">test.ini</span></code> or <code class="docutils literal"><span class="pre">test-core.ini</span></code>. The problem
is that these are versioned files and people have checked in these by
mistake, creating problems for other developers.</p>
</div>
</div>
<div class="section" id="common-error-messages">
<h2>Common error messages<a class="headerlink" href="test.html#common-error-messages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configerror">
<h3>ConfigError<a class="headerlink" href="test.html#configerror" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">nose.config.ConfigError:</span> <span class="pre">Error</span> <span class="pre">reading</span> <span class="pre">config</span> <span class="pre">file</span> <span class="pre">'setup.cfg':</span> <span class="pre">no</span> <span class="pre">such</span> <span class="pre">option</span> <span class="pre">'with-pylons'</span></code></dt>
<dd><p class="first">This error can result when you run nosetests for two reasons:</p>
<ol class="last arabic">
<li><p class="first">Pylons nose plugin failed to run. If this is the case, then within a couple of lines of running <cite>nosetests</cite> you&#8217;ll see this warning: <cite>Unable to load plugin pylons</cite> followed by an error message. Fix the error here first`.</p>
</li>
<li><p class="first">The Python module &#8216;Pylons&#8217; is not installed into you Python environment. Confirm this with:</p>
<div class="highlight-python"><div class="highlight"><pre>python -c &quot;import pylons&quot;
</pre></div>
</div>
</li>
</ol>
</dd>
</dl>
</div>
<div class="section" id="operationalerror">
<h3>OperationalError<a class="headerlink" href="test.html#operationalerror" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">OperationalError:</span> <span class="pre">(OperationalError)</span> <span class="pre">no</span> <span class="pre">such</span> <span class="pre">function:</span> <span class="pre">plainto_tsquery</span> <span class="pre">...</span></code></dt>
<dd>This error usually results from running a test which involves search functionality, which requires using a PostgreSQL database, but another (such as SQLite) is configured. The particular test is either missing a <cite>&#64;search_related</cite> decorator or there is a mixup with the test configuration files leading to the wrong database being used.</dd>
</dl>
</div>
<div class="section" id="nosetests">
<h3>nosetests<a class="headerlink" href="test.html#nosetests" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">nosetests:</span> <span class="pre">error:</span> <span class="pre">no</span> <span class="pre">such</span> <span class="pre">option:</span> <span class="pre">--ckan</span></code></dt>
<dd><p class="first">Nose is either unable to find ckan/ckan_nose_plugin.py in the python environment it is running in, or there is an error loading it. If there is an error, this will surface it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nosetests</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>There are a few things to try to remedy this:</p>
<p>Commonly this is because the nosetests isn&#8217;t running in the python environment. You need to have nose actually installed in the python environment. To see which you are running, do this:</p>
<div class="highlight-python"><div class="highlight"><pre>which nosetests
</pre></div>
</div>
<p>If you have activated the environment and this still reports <code class="docutils literal"><span class="pre">/usr/bin/nosetests</span></code> then you need to:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install --ignore-installed nose
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">nose</span> <span class="pre">--version</span></code> still fails, ensure that ckan is installed in your environment:</p>
<pre class="literal-block">
cd /usr/lib/ckan/default/src/ckan
python setup.py develop
</pre>
<p>One final check - the version of nose should be at least 1.0. Check with:</p>
<div class="last highlight-python"><div class="highlight"><pre>pip freeze | grep -i nose
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="front-end-testing">
<h2>Front-end Testing<a class="headerlink" href="test.html#front-end-testing" title="Permalink to this headline">¶</a></h2>
<p>All new CKAN features should be coded so that they work in the
following browsers:</p>
<ul class="simple">
<li>Internet Explorer: 9, 8 and 7</li>
<li>Firefox: Latest + previous version</li>
<li>Chrome: Latest + previous version</li>
</ul>
<p>These browsers are determined by whatever has &gt;= 1% share with the
latest months data from: <a class="reference external" href="http://data.gov.uk/data/site-usage">http://data.gov.uk/data/site-usage</a></p>
<div class="section" id="install-browser-virtual-machines">
<h3>Install browser virtual machines<a class="headerlink" href="test.html#install-browser-virtual-machines" title="Permalink to this headline">¶</a></h3>
<p>In order to test in all the needed browsers you&#8217;ll need access to
all the above browser versions. Firefox and Chrome should be easy
whatever platform you are on. Internet Explorer is a little trickier.
You&#8217;ll need Virtual Machines.</p>
<p>We suggest you use <a class="reference external" href="https://github.com/xdissent/ievms">https://github.com/xdissent/ievms</a> to get your
Internet Explorer virtual machines.</p>
</div>
<div class="section" id="testing-methodology">
<h3>Testing methodology<a class="headerlink" href="test.html#testing-methodology" title="Permalink to this headline">¶</a></h3>
<p>Firstly we have a primer page. If you&#8217;ve touched any of the core
front-end code you&#8217;ll need to check if the primer is rendering
correctly. The primer is located at:
<a class="reference external" href="http://localhost:5000/testing/primer">http://localhost:5000/testing/primer</a></p>
<p>Secondly whilst writing a new feature you should endeavour to test
in at least in your core browser and an alternative browser as often
as you can.</p>
<p>Thirdly you should fully test all new features that have a front-end
element in all browsers before making your pull request into
CKAN master.</p>
</div>
<div class="section" id="common-pitfalls-their-fixes">
<h3>Common pitfalls &amp; their fixes<a class="headerlink" href="test.html#common-pitfalls-their-fixes" title="Permalink to this headline">¶</a></h3>
<p>Here&#8217;s a few of the most common front end bugs and a list of their
fixes.</p>
<div class="section" id="reserved-js-keywords">
<h4>Reserved JS keywords<a class="headerlink" href="test.html#reserved-js-keywords" title="Permalink to this headline">¶</a></h4>
<p>Since IE has a stricter language definition in JS it really doesn&#8217;t
like you using JS reserved keywords method names, variables, etc...
This is a good list of keywords not to use in your JavaScript:</p>
<p><a class="reference external" href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Reserved_Words">https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Reserved_Words</a></p>
<div class="highlight-python"><div class="highlight"><pre>/* These are bad */
var a = {
  default: 1,
  delete: function() {}
};

/* These are good */
var a = {
  default_value: 1,
  remove: function() {}
};
</pre></div>
</div>
</div>
<div class="section" id="unclosed-js-arrays-objects">
<h4>Unclosed JS arrays / objects<a class="headerlink" href="test.html#unclosed-js-arrays-objects" title="Permalink to this headline">¶</a></h4>
<p>Internet Explorer doesn&#8217;t like it&#8217;s JS to have unclosed JS objects
and arrays. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>/* These are bad */
var a = {
  b: &#39;c&#39;,
};
var a = [&#39;b&#39;, &#39;c&#39;, ];

/* These are good */
var a = {
  c: &#39;c&#39;
};
var a = [&#39;b&#39;, &#39;c&#39;];
</pre></div>
</div>
</div>
</div>
</div>
</div>



        
        <div style="font-size:smaller;">
          <hr/>
          
            
          
            
              <div class="pull-right">
                <a href="configuration.html"
                  title="Config File Options" accesskey="N">
                    
                      
                    
                    Config File Options→
                </a>
              </div>
            
          
            
              <div >
                <a href="documentation-guidelines.html"
                  title="Documentation guidelines" accesskey="P">
                    
                      
                    
                    ← Documentation guidelines
                </a>
              </div>
            
          
          <div style="clear:both;"></div>
        </div>

      </div>
    </div>
  </div> <!-- / row -->
</div>

<footer>
  <div class="inner">
    <div class="container-fluid">
      <p>An <a href="http://okfn.org">Open Knowledge Foundation</a> project.</p>

<p class="copyright">
  &copy; 2009-2012, <a href="http://okfn.org/">Open Knowledge Foundation</a>.
    Licensed under <a
    href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
    Attribution ShareAlike (Unported) v3.0 License</a>.<br />
    <img src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" alt="CC License Logo" />
    <a href="http://opendefinition.org/"><img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" border="0" 
      alt="{{ _('Open Content') }}" /></a>
  <br/>
</p>

<p>
<a href="https://github.com/okfn/ckan">Source</a>
&mdash;
<a href="https://github.com/okfn/ckan/issues">Issues</a>
&mdash;
<a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">Mailing List</a>
&mdash;
<a href="http://twitter.com/CKANProject">Twitter @CKANProject</a>
</p>

<p>
Related Projects:
<a href="http://thedatahub.org/">The DataHub</a>
&mdash;
<a href="http://datacatalogs.org">DataCatalogs.org</a>
&mdash;
<a href="http://openspending.org">OpenSpending.org</a>
&mdash;
<a href="http://opendatahandbook.org">Open Data Handbook</a>
</p>

    </div>
  </div>
</footer>



  </body>
</html>