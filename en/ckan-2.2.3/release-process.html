<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Doing a CKAN Release &mdash; CKAN 2.2.3 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/fix.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="https://media.readthedocs.org/css/badge_only.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
    <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>
    <script type="text/javascript" src="_static/bootstrap-css-tweaks.js"></script>
    <link rel="top" title="CKAN 2.2.3 documentation" href="index.html" />
    <link rel="up" title="Upgrading CKAN" href="upgrading.html" />
    <link rel="next" title="Upgrading a CKAN 1 package install to CKAN 2.0" href="upgrade-package-ckan-1-to-2.html" />
    <link rel="prev" title="Upgrading CKAN" href="upgrading.html" />

  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://docs.ckan.org/en/latest/release-process.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'release-process'
</script>

<script type="text/javascript" src="_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>
  <body>
  
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        
        <a class="logo-icon pull-left" href="contents.html"><img src="_static/ckanlogo.png" alt="CKAN" /></a>
        
        <a class="brand" href="contents.html">CKAN<span class="version"> v2.2.3</span></a>
        
        
        <a class="okfn-logo pull-right" href="http://okfn.org/" title="An Open Knowledge Foundation Project">
          <img src="https://s3.amazonaws.com/assets.okfn.org/p/okfn/img/logo_28x30.png" alt="Open Knowledge Foundation logo" />
        </a>
        
        
          
<form class="pull-right navbar-search" action="http://docs.ckan.org/en/ckan-2.2.3/search.html" method="get">
  <input type="text" name="q" placeholder="Search" class="search-query span2" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        
      </div>
    </div>
  </div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span4">
      <div class="well sidebar-nav">
        
          
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><div class="widget toc">
  <h3>Table of Contents</h3>
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Welcome to CKAN&#8217;s Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="sysadmin-guide.html">Sysadmin guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing CKAN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="upgrading.html">Upgrading CKAN</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#ckan-releases">CKAN releases</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="upgrading.html#release-process">Release process</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="release-process.html">Doing a CKAN Release</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="upgrading.html#upgrading">Upgrading CKAN</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensions/index.html">Writing CKAN extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="theming.html">Theming</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">The CKAN API</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Testing CKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Config File Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices/index.html">Appendices</a></li>
</ul>

</div>

        </div>
      </div>
        
      </div><!--/.well -->
    </div><!--/span-->
    <div class="span8">
      <div class="content">

        
        <div style="font-size:smaller;">
              <a href="contents.html">CKAN 2.2.3 documentation</a> &raquo;
              <a href="upgrading.html"
                    accesskey="U">
                    Upgrading CKAN
                  </a>
                   &raquo;
        </div>

        
  <div class="section" id="doing-a-ckan-release">
<h1>Doing a CKAN Release<a class="headerlink" href="release-process.html#doing-a-ckan-release" title="Permalink to this headline">¶</a></h1>
<p>These are the steps followed by CKAN developers to do a release. To get an
overview of CKAN releases, check <a class="reference internal" href="upgrading.html"><em>Upgrading CKAN</em></a>.</p>
<div class="section" id="doing-a-beta-release">
<span id="beta-release"></span><h2>Doing a Beta Release<a class="headerlink" href="release-process.html#doing-a-beta-release" title="Permalink to this headline">¶</a></h2>
<p>Beta releases are branched off a certain point in master and will eventually
become stable releases.</p>
<ol class="arabic">
<li><p class="first">Create a new release branch:</p>
<div class="highlight-python"><div class="highlight"><pre>git checkout -b release-v1.8
</pre></div>
</div>
<p>Update <tt class="docutils literal"><span class="pre">ckan/__init__.py</span></tt> to change the version number to the new version
with a <em>b</em> after it, e.g. <em>1.8b</em>.
Commit the change and push the new branch to GitHub:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -am &quot;Update version number&quot;
git push origin release-v1.8
</pre></div>
</div>
<p>You will probably need to update the same file on master to increase the
version number, in this case ending with an <em>a</em> (for alpha).</p>
</li>
<li><p class="first">Check if there have been changes in the Solr schema at
<tt class="docutils literal"><span class="pre">ckan/config/solr/schema.xml</span></tt>, and if so:</p>
<blockquote>
<div><ul>
<li><p class="first">Update the <tt class="docutils literal"><span class="pre">version</span></tt> attribute of the <tt class="docutils literal"><span class="pre">schema</span></tt> with the current CKAN
version:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;schema name=&quot;ckan&quot; version=&quot;{version}&quot;&gt;
</pre></div>
</div>
</li>
<li><p class="first">Update the <tt class="docutils literal"><span class="pre">SUPPORTED_SCHEMA_VERSIONS</span></tt> list in
<tt class="docutils literal"><span class="pre">ckan/lib/search/__init__.py</span></tt></p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">During the beta process, all changes to the release branch must be
cherry-picked from master (or merged from special branches based on the
release branch if the original branch was not compatible).</p>
</li>
<li><p class="first">As in the master branch, if some commits involving CSS changes are
cherry-picked from master, the less compiling command needs to be run on
the release branch. This will update the <tt class="docutils literal"><span class="pre">main.css</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre>./bin/less --production
git commit -am &quot;Rebuild CSS&quot;
git push
</pre></div>
</div>
<p>There will be a final front-end build before the actual release.</p>
</li>
<li><p class="first">The beta staging site (<a class="reference external" href="http://beta.ckan.org">http://beta.ckan.org</a>, currently on s084) should be
updated regularly to allow user testing.</p>
</li>
<li><p class="first">Once the translation freeze is in place (ie no changes to the translatable
strings are allowed), strings need to be extracted and uploaded to
<a class="reference external" href="https://www.transifex.com/projects/p/ckan">Transifex</a>:</p>
<ol class="loweralpha">
<li><p class="first">Install the Babel and Transifex libraries if necessary:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install --upgrade Babel
pip install transifex-client
</pre></div>
</div>
</li>
<li><p class="first">Create a <tt class="docutils literal"><span class="pre">~/.transifexrc</span></tt> file if necessary with your login details
(<tt class="docutils literal"><span class="pre">token</span></tt> should be left blank):</p>
<div class="highlight-python"><div class="highlight"><pre>[https://www.transifex.com]
hostname = https://www.transifex.com
username = &lt;username&gt;
password = &lt;password&gt;
token =
</pre></div>
</div>
</li>
<li><p class="first">Extract new strings from the CKAN source code into the <tt class="docutils literal"><span class="pre">ckan.pot</span></tt>
file. The pot file is a text file that contains the original,
untranslated strings extracted from the CKAN source code.:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py extract_messages
</pre></div>
</div>
</li>
<li><p class="first">Pull new and updated translations from Transifex into the <tt class="docutils literal"><span class="pre">ckan.po</span></tt>
files:</p>
<div class="highlight-python"><div class="highlight"><pre>tx pull --all --force
</pre></div>
</div>
<p>The po files are text files, one for each language CKAN is translated to,
that contain the translated strings next to the originals. Translators edit
the po files (on Transifex) to update the translations. We never edit the
po files locally.</p>
<p><tt class="docutils literal"><span class="pre">--force</span></tt> tells Transifex to update all <tt class="docutils literal"><span class="pre">ckan.po</span></tt> files, regardless of the
modification time.</p>
</li>
<li><p class="first">Run our script that checks for mistakes in the ckan.po files:</p>
<div class="highlight-python"><div class="highlight"><pre>pip install polib
paster check-po-files ckan/i18n/*/LC_MESSAGES/ckan.po
</pre></div>
</div>
<p>If the script finds any mistakes correct them on Transifex and then run the
tx pull command again, don&#8217;t edit the files directly. Repeat until the
script finds no mistakes.</p>
</li>
<li><p class="first">Edit <tt class="docutils literal"><span class="pre">.tx/config</span></tt>, on line 4 to set the Transifex &#8216;resource&#8217; to the new
major release name (if different), using dashes instead of dots.
For instance v1.2, v1.2.1 and v1.2.2 all share: <tt class="docutils literal"><span class="pre">[ckan.1-2]</span></tt>.</p>
</li>
<li><p class="first">Update the <tt class="docutils literal"><span class="pre">ckan.po</span></tt> files with the new strings from the <tt class="docutils literal"><span class="pre">ckan.pot</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py update_catalog --no-fuzzy-matching
</pre></div>
</div>
<p>Any new or updated strings from the CKAN source code will get into the po
files, and any strings in the po files that no longer exist in the source
code will be deleted (along with their translations).</p>
<p>We use the <tt class="docutils literal"><span class="pre">--no-fuzzy-matching</span></tt> option because fuzzy matching often
causes problems with Babel and Transifex.</p>
</li>
<li><p class="first">Create a new resource in the CKAN project on Transifex by pushing the new
pot and po files:</p>
<div class="highlight-python"><div class="highlight"><pre>tx push --source --translations --force
</pre></div>
</div>
<p>Because it reads the new version number in the <tt class="docutils literal"><span class="pre">.tx/config</span></tt> file, tx will
create a new resource on Transifex rather than updating an existing
resource (updating an existing resource, especially with the <tt class="docutils literal"><span class="pre">--force</span></tt>
option, can result in translations being deleted from Transifex).</p>
</li>
<li><p class="first">Update the <tt class="docutils literal"><span class="pre">ckan.mo</span></tt> files by compiling the po files:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py compile_catalog
</pre></div>
</div>
<p>The mo files are the files that CKAN actually reads when displaying
strings to the user.</p>
</li>
<li><p class="first">Commit all the above changes to git and push them to GitHub:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -am &quot; Update strings files before CKAN X.Y call for translations&quot;
git push
</pre></div>
</div>
</li>
<li><p class="first">Announce that strings for the new release are ready for translators. Send
an email to the mailing lists, tweet or post it on the blog. Make sure to
post a link to the correct Transifex resource (like
<a class="reference external" href="https://www.transifex.com/projects/p/ckan/resource/2-0/">this one</a>)
and tell users that they can register on Transifex to contribute.</p>
</li>
<li><p class="first">A week before the translations will be closed send a reminder email.</p>
</li>
<li><p class="first">Once the translations are closed, pull the updated strings from Transifex,
check them, compile and push as described in the previous steps:</p>
<div class="highlight-python"><div class="highlight"><pre>tx pull --all --force
paster check-po-files ckan/i18n/*/LC_MESSAGES/ckan.po
python setup.py compile_catalog
git commit -am &quot; Update translations from Transifex&quot;
git push
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="doing-a-proper-release">
<h2>Doing a Proper Release<a class="headerlink" href="release-process.html#doing-a-proper-release" title="Permalink to this headline">¶</a></h2>
<p>Once the release branch has been thoroughly tested and is stable we can do
a release.</p>
<ol class="arabic">
<li><p class="first">Run the most thorough tests:</p>
<div class="highlight-python"><div class="highlight"><pre>nosetests ckan/tests --ckan --ckan-migration --with-pylons=test-core.ini
</pre></div>
</div>
</li>
<li><p class="first">Do a final build of the front-end and commit the changes:</p>
<div class="highlight-python"><div class="highlight"><pre>paster front-end-build
git commit -am &quot;Rebuild front-end&quot;
</pre></div>
</div>
</li>
<li><p class="first">Update the CHANGELOG.txt with the new version changes:</p>
<ul>
<li><p class="first">Add the release date next to the version number</p>
</li>
<li><p class="first">Add the following notices at the top of the release, reflecting whether
updates in requirements, database or Solr schema are required or not:</p>
<div class="highlight-python"><div class="highlight"><pre>Note: This version requires a requirements upgrade on source installations
Note: This version requires a database upgrade
Note: This version does not require a Solr schema upgrade
</pre></div>
</div>
</li>
<li><p class="first">Check the issue numbers on the commit messages for information about
the changes. These are some helpful git commands:</p>
<div class="highlight-python"><div class="highlight"><pre>git branch -a --merged &gt; merged-current.txt
git branch -a --merged ckan-1.8.1 &gt; merged-previous.txt
diff merged-previous.txt merged-current.txt

git log --no-merges release-v1.8.1..release-v2.0
git shortlog --no-merges release-v1.8.1..release-v2.0
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Check that the docs compile correctly:</p>
<div class="highlight-python"><div class="highlight"><pre>rm build/sphinx -rf
python setup.py build_sphinx
</pre></div>
</div>
</li>
<li><p class="first">Remove the beta letter in the version number in <tt class="docutils literal"><span class="pre">ckan/__init__.py</span></tt>
(eg 1.1b -&gt; 1.1) and commit the change:</p>
<div class="highlight-python"><div class="highlight"><pre>git commit -am &quot;Update version number for release X.Y&quot;
</pre></div>
</div>
</li>
<li><p class="first">Tag the repository with the version number, and make sure to push it to
GitHub afterwards:</p>
<div class="highlight-python"><div class="highlight"><pre>git tag -a -m &#39;[release]: Release tag&#39; ckan-X.Y
git push --tags
</pre></div>
</div>
</li>
<li><p class="first">Upload the release to PyPI:</p>
<div class="highlight-python"><div class="highlight"><pre>python setup.py sdist upload
</pre></div>
</div>
<p>You will need a PyPI account with admin permissions on the ckan package,
and your credentials should be defined on a <tt class="docutils literal"><span class="pre">~/.pypirc</span></tt> file, as described
<a class="reference external" href="http://docs.python.org/distutils/packageindex.html#pypirc">here</a>
If you make a mistake, you can always remove the release file on PyPI and
re-upload it.</p>
</li>
<li><p class="first">Enable the new version of the docs on Read the Docs (you will need an admin
account):</p>
<ol class="loweralpha simple">
<li>Go to the <cite>versions page &lt;http://readthedocs.org/dashboard/ckan/versions/&gt;</cite>
and enable the relevant release (make sure to use the tag, ie ckan-X.Y,
not the branch, ie release-vX.Y).</li>
<li>If it is the latest stable release, set it to be the Default Version and
check it is displayed on <a class="reference external" href="../../index.html">http://docs.ckan.org</a>.</li>
</ol>
</li>
<li><p class="first">Write a <a class="reference external" href="http://ckan.org/wp-admin">CKAN Blog post</a> and send an email to
the mailing list announcing the release, including the relevant bit of
changelog.</p>
</li>
<li><p class="first">Cherry-pick the i18n changes from the release branch onto master.</p>
<p>Generally we don&#8217;t merge or cherry-pick release branches into master, but
the files in ckan/i18n are an exception. These files are only ever changed
on release branches following the <a class="reference internal" href="release-process.html#beta-release"><em>Doing a Beta Release</em></a> instructions above,
and after a release has been finalized the changes need to be cherry-picked
onto master.</p>
<p>To find out what i18n commits there are on the release-v* branch that are
not on master, do:</p>
<div class="highlight-python"><div class="highlight"><pre>git log master..release-v* ckan/i18n
</pre></div>
</div>
<p>Then <tt class="docutils literal"><span class="pre">checkout</span></tt> the master branch, do a <tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> and a <tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt>
to make sure you have the latest commits on master and no local changes.
Then use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">cherry-pick</span></tt> when on the master branch to cherry-pick these
commits onto master. You should not get any merge conflicts. Run the
<tt class="docutils literal"><span class="pre">check-po-files</span></tt> command again just to be safe, it should not report any
problems. Run CKAN&#8217;s tests, again just to be safe.  Then do <tt class="docutils literal"><span class="pre">git</span> <span class="pre">push</span>
<span class="pre">origin</span> <span class="pre">master</span></tt>.</p>
</li>
</ol>
</div>
</div>



        
        <div style="font-size:smaller;">
          <hr/>
          
            
          
            
          
            
              <div class="pull-right">
                <a href="upgrade-package-ckan-1-to-2.html"
                  title="Upgrading a CKAN 1 package install to CKAN 2.0" accesskey="N">
                    
                      
                    
                    Upgrading a CKAN 1 package install to CKAN 2.0→
                </a>
              </div>
            
          
            
              <div >
                <a href="upgrading.html"
                  title="Upgrading CKAN" accesskey="P">
                    
                      
                    
                    ← Upgrading CKAN
                </a>
              </div>
            
          
          <div style="clear:both;"></div>
        </div>

      </div>
    </div>
  </div> <!-- / row -->
</div>

<footer>
  <div class="inner">
    <div class="container-fluid">
      <p>An <a href="http://okfn.org">Open Knowledge Foundation</a> project.</p>

<p class="copyright">
  &copy; 2009-2013, <a href="http://okfn.org/">Open Knowledge Foundation</a>.
    Licensed under <a
    href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
    Attribution ShareAlike (Unported) v3.0 License</a>.<br />
    <img src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" alt="CC License Logo" />
    <a href="http://opendefinition.org/"><img src="http://assets.okfn.org/images/ok_buttons/oc_80x15_blue.png" border="0"
      alt="{{ _('Open Content') }}" /></a>
  <br/>
</p>

<p>
<a href="https://github.com/ckan/ckan">Source</a>
&mdash;
<a href="https://github.com/ckan/ckan/issues">Issues</a>
&mdash;
<a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">Mailing List</a>
&mdash;
<a href="http://twitter.com/CKANProject">Twitter @CKANProject</a>
</p>

<p>
Related Projects:
<a href="http://thedatahub.org/">The DataHub</a>
&mdash;
<a href="http://datacatalogs.org">DataCatalogs.org</a>
&mdash;
<a href="http://openspending.org">OpenSpending.org</a>
&mdash;
<a href="http://opendatahandbook.org">Open Data Handbook</a>
</p>

    </div>
  </div>
</footer>



  </body>
</html>